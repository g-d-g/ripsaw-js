/*! ripsaw v0.0.1 - 2015-09-06 
 *  Copyright: Peter Szerzo, 2014 */


var RIPSAW={mode:"mode3",isModified:!1,time0:(new Date).getTime(),time:0,refreshInterval:5,anim:{speed:2e3,delay:500},containerID:"ripsaw-app",fonts:"Monaco",tolerance:.02,delta:1e-7,delta2:.001,defaultRadius:5,wDisplay:{path:.005,navButton:.03,text:1/80},rDim:{l:150,w:0,d:3,depthScale:10},mesh:{n1:100,n2:30,nP:3},masterPiece:{},padding:0};RIPSAW.textAssets={shapeLibrary:{fork:"M812.146,568.452c-52.453,1.613-75.052-19.368-75.052-19.368s25.041-21.028,75.859-20.174c71.82,1.211,104.502-31.494,104.502-31.494s-36.717-34.678-106.52-33.871c-57.942,0.672-72.765-19.906-72.765-19.906s11.267-17.453,58.642-16.405c73.03,1.612,132.834-23.802,132.834-23.802c-267.869-111.5-264.88,45.689-424.959,35.904C290.183,426.229,63.01,307.15,70.535,484.526c6.455,152.186,145.255,64.558,422.294,69.399c189.035,3.305,216.292,149.023,434.714,45.998C927.543,599.924,880.07,566.362,812.146,568.452z",person:"M75.303,533.052c6.047-65.575,80.289-100.945,124.724-54.667c49.041,51.07,127.95-12.528,71.852-141.562c-53.526-123.12,98.943-150.686,76.232-11.144C330.313,435.04,450.169,454.823,531.399,448.803c119.931-8.888,240.646-99.284,282.131-141.198c74.615-75.384,147.605,80.856,42.819,114.361c-102.57,32.796-177.442,45.126-174.202,107.489c3.158,60.764,63.259,100.824,165.825,102.922c139.445,2.85,65.561,197.484-31.098,111.666c-94.177-83.614-222.416-138.441-306.662-140.58C372.517,599.966,323.882,636.691,354.5,746.05c31.259,111.651-124.696,102.712-87.589,1.838c47.478-129.076,8.109-209.991-58.472-152.687C155.535,640.734,68.186,610.213,75.303,533.052z",moustache:"M745.947,405.463c106.682,88.078,192.916,26.735,192.916,26.735C754.697,759.384,501.959,567.383,501.959,567.383C272.733,769.18,61.138,463.543,61.138,463.543c56.816,43.103,128.065,50.273,186.069-7.729c58.006-58.005,162.409-123.742,254.752,27.065C560.734,350.4,659.676,334.236,745.947,405.463z"},SVGHeader:['<svg version="1.1" id="trace" ','xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" ','viewBox="0 0 200 100" ','style="enable-background:new 0 0 200 100;" xml:space="preserve" >'].join("\n"),SVGFooter:"</svg>",rhinoPythonScriptHeader:['\n"""\n\nScript file generated by Yourk, www.RIPSAW.com/Yourk/experiment_1',"\nInstructions:","	- copy this code and paste it into a *.py file","	- open Rhino (rhino3d.com). The software is currently in development for Mac and free to use. Commercial license is needed for Windows. [stay tuned for a SketchUp implementation]","	- type RunPythonScript in the Rhino command line, and select your file.","	- in the current development phase, the geometry generated by this script needs to be trimmed manually to obtain the final 3d model. Stay tuned for full automation.","	- Rhino exports seamlessly into .stl format, which is directly imported into MakerWare, the software used to send geometries to MakerBot 3d printers. Check out the image gallery under RIPSAW.com/design/Yourk/ for images of the very first Yourk 3d printing process.",'\n"""',"\nimport rhinoscriptsyntax as rs\n\nimport math\n\ndef Main():\n\n"].join("\n"),rhinoPythonScriptFooter:"Main()"},RIPSAW.touchHandler=function(a){var b=a.changedTouches[0],c=document.createEvent("MouseEvent");return c.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[a.type],!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(c),this},RIPSAW.addTouchHandlers=function(){return document.addEventListener("touchstart",this.touchHandler,!0),document.addEventListener("touchmove",this.touchHandler,!0),document.addEventListener("touchend",this.touchHandler,!0),document.addEventListener("touchcancel",this.touchHandler,!0),this},RIPSAW.createCanvas=function(){return this.canvas=document.createElement("canvas"),this.canvas.id="ripsaw-canvas",this.ctx=this.canvas.getContext("2d"),this.ctx.lineCap="round",this.canvas.style.margin="auto",this.container.appendChild(this.canvas),this},RIPSAW.addDefaultEventListeners=function(){return"undefined"==typeof this.mouseDown&&(RIPSAW.mouseDown=function(a){a.preventDefault(),!a.which&&a.button&&(1&a.button?a.which=1:4&a.button?a.which=2:2&a.button&&(a.which=3)),1===a.which?(RIPSAW.mouse.update(a,"down"),RIPSAW.masterPiece.mouseDown()):3===a.which&&RIPSAW.masterPiece.mouseDownRight()}),"undefined"==typeof this.mouseMove&&(RIPSAW.mouseMove=function(a){RIPSAW.mouse.update(a,"move"),RIPSAW.masterPiece.mouseMove()}),"undefined"==typeof this.mouseUp&&(RIPSAW.mouseUp=function(a){RIPSAW.mouse.update(a,"up"),RIPSAW.masterPiece.mouseUp()}),"undefined"==typeof this.keyPressed&&(RIPSAW.keyPressed=function(){RIPSAW.masterPiece.keyPressed()}),this.canvas.addEventListener("mousedown",this.mouseDown),this.canvas.addEventListener("mousemove",this.mouseMove),this.canvas.addEventListener("mouseup",this.mouseUp),window.addEventListener("keypressed",this.keyPressed),this},RIPSAW.resize=function(){{var a,b;RIPSAW.container.style}return a=b=2*RIPSAW.padding,RIPSAW.W=RIPSAW.container.clientWidth-a,RIPSAW.H=RIPSAW.container.clientHeight-b,(RIPSAW.W<0||RIPSAW.H<0)&&(RIPSAW.W=0,RIPSAW.H=0,setTimeout(RIPSAW.resize,200)),RIPSAW.minWH=Math.min(RIPSAW.W,RIPSAW.H),RIPSAW.maxWH=Math.max(RIPSAW.W,RIPSAW.H),RIPSAW.canvas.width=RIPSAW.W,RIPSAW.canvas.height=RIPSAW.H,this},RIPSAW.init=function(){return this.container=document.getElementById(this.containerID),this.createCanvas(),this.isModified=!1,this.addDefaultEventListeners(),this.addTouchHandlers(),window.addEventListener("resize",RIPSAW.resize,!1),this.resize(),this},RIPSAW.prepDraw=function(){return RIPSAW.ctx.fillStyle=RIPSAW.colors.get(0,1),RIPSAW.pen.solidRect(0,0,RIPSAW.W,RIPSAW.H),RIPSAW.ctx.textAlign="center",RIPSAW.ctx.textBaseline="middle",RIPSAW.time=(new Date).getTime(),this},RIPSAW.launch=function(){return RIPSAW.resize(),RIPSAW.draw=RIPSAW.draw||function(){RIPSAW.prepDraw(),RIPSAW.masterPiece.draw()},setInterval(RIPSAW.draw,RIPSAW.refreshInterval),this},RIPSAW.tearDown=function(){return this.canvas.parentNode.removeChild(this.canvas),this},RIPSAW.events={on:function(a,b){this._events=this._events||{};var c=this._events[a]||(this._events[a]=[]);c.push({callback:b})},off:function(a,b){var c,d,e=this._events[a],f=-1;for(c=0,d=e.length,c=0;d>c;c+=1)e[c].callback===b&&(f=c);-1!==f&&e.splice(f,1)},trigger:function(a){var b,c=this._events[a]||[],d=c.length;for(b=0;d>b;b+=1)c[b].callback()}},RIPSAW.observer=function(){var a=[],b={};return b.indexOf=function(b){return a.indexOf(b)},b.getSubscriber=function(b){return a[b]},b.subscribe=function(c){return a.push(c),b},b.unsubscribe=function(c){var d=this.indexOf(c);return"undefined"!=typeof d&&-1!==d&&a.splice(d,1),b},b.fire=function(b){var c,d,e=a.length;for(c=0;e>c;c+=1)d=a[c],"undefined"!=typeof d&&"undefined"!=typeof d[b]&&d[b]()},b},RIPSAW.inherit=function(a){function b(){}return b.prototype=a,new b},RIPSAW.inheritPrototype=function(a,b){var c;"undefined"==typeof b&&(b=function(){});for(c in a.prototype)b.prototype[c]=a.prototype[c];return b},RIPSAW.bind=function(a,b){return function(){return a.apply(b,Array.prototype.slice.call(arguments))}},RIPSAW.extend=function(a,b){var c;a=a||{};for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},RIPSAW.areNearEqual=function(a,b,c){var d="undefined"==typeof c?RIPSAW.delta:c;return Math.abs(a-b)<d},RIPSAW.map=function(a){return new RIPSAW.Vector(a.x*RIPSAW.W,a.y*RIPSAW.H,0)},RIPSAW.sineAnimate=function(a,b,c,d,e){var f;return f=RIPSAW.time-RIPSAW.time0<d?0:RIPSAW.time-RIPSAW.time0>e?e-d:RIPSAW.time-RIPSAW.time0-d,Math.sin(f/b*2*Math.PI+c)},RIPSAW.Matrix=function(a,b){this.n=a||2,this.m=b||2,this.table=[];for(var c=0;c<this.n;c+=1){this.table.push([]);for(var d=0;d<this.m;d+=1)this.table[c].push(0)}return this},RIPSAW.Matrix.prototype={toString:function(){var a,b,c="Matrix "+this.n+" x "+this.m+"\n";for(a=0;a<this.n;a+=1){for(c+="|",b=0;b<this.m;b+=1)c+=" "+this.table[a][b]+" ";c+="|\n"}return console.log(new RIPSAW.Matrix(2,2).populate(1,0,0,1).inverse()),c},populate:function(){var a,b=arguments.length;for(a=0,b=arguments.length;b>a;a+=1)this.table[Math.floor(a/this.m)][a%this.m]=arguments[a];return this},determinant:function(){var a=this.table;return 2===this.n&&2===this.m?a[0][0]*a[1][1]-a[0][1]*a[1][0]:void 0},inverse:function(){var a=this.determinant(),b=new RIPSAW.Matrix(this.n,this.m);return 0===a?void 0:(2===this.n&&2===this.m&&(b.table[0][0]=+this.table[1][1]/a,b.table[1][0]=-this.table[1][0]/a,b.table[0][1]=-this.table[0][1]/a,b.table[1][1]=+this.table[0][0]/a),b)},multiply:function(a){var b,c,d,e,f=this,g=new RIPSAW.Matrix(f.n,a.m);for(b=0;b<f.n;b+=1)for(c=0;c<a.m;c+=1){for(e=0,d=0;d<f.m;d+=1)e+=f.table[b][d]*a.table[d][c];g.table[b][c]=e}for(this.n=g.n,this.m=g.m,this.table=[],b=0;b<this.n;b+=1)for(this.table.push([]),c=0;c<this.m;c+=1)this.table[b].push(g.table[b][c]);return this},clone:function(){var a,b,c=new RIPSAW.Matrix(this.n,this.m);for(a=0;a<this.n;a+=1)for(b=0;b<this.m;b+=1)c.table[a][b]=this.table[a][b];return c}},RIPSAW.Vector=function(a,b,c){return this.x=a||0,this.y=b||0,this.z=c||0,this},RIPSAW.Vector.prototype={constructor:RIPSAW.Vector,log:function(a){var b=a||2;return"x: "+this.x.toFixed(b)+" | y: "+this.y.toFixed(b)+" | z: "+this.z.toFixed(b)},toString:function(a){var b=a||2;return"["+this.x.toFixed(b)+","+this.y.toFixed(b)+","+this.z.toFixed(b)+"]"},match:function(a){var b=Math.abs(this.x-a.x),c=Math.abs(this.y-a.y),d=Math.abs(this.z-a.z);return b<RIPSAW.delta&&c<RIPSAW.delta&&d<RIPSAW.delta&&(this.x=a.x,this.y=a.y,this.z=a.z),this},isNearEqualTo:function(a){return Math.abs(this.x-a.x)<RIPSAW.delta&&Math.abs(this.y-a.y)<RIPSAW.delta&&Math.abs(this.z-a.z)<RIPSAW.delta},getDistanceTo:function(a){return Math.pow(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2)+Math.pow(this.z-a.z,2),.5)},getManhattanDistanceTo:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},normalize:function(a){var b=this.getDistanceTo(new RIPSAW.Vector(0,0,0)),c=0!==b?(a||1)/b:1;return this.x*=c,this.y*=c,this.z*=c,this},add:function(a){return a instanceof RIPSAW.Vector&&(this.x+=a.x||0,this.y+=a.y||0,this.z+=a.z||0),this},subtract:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},scale:function(a){return this.x*=a,this.y*=a,this.z*=a,this},dotProduct:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},product:function(a){return this.getProduct(a)},getProduct:function(a){return new RIPSAW.Vector(this.x*a.x,this.y*a.y,this.z*a.z)},crossMultiply:function(a){var b=+this.y*a.z-this.z*a.y,c=-this.x*a.z+this.z*a.x,d=+this.x*a.y-this.y*a.x;return this.x=b,this.y=c,this.z=d,this},getCrossProduct:function(a){return this.clone().crossMultiply(a)},clone:function(a){return new RIPSAW.Vector(this.x,this.y,this.z).add(a)},getLinearCombination:function(a,b){for(var c=Math.min(a.length,b.length),d=0,e=0,f=0,g=0;c>g;g+=1)d+=a[g].x*b[g],e+=a[g].y*b[g],f+=a[g].z*b[g];return new RIPSAW.Vector(d,e,f)},swapYZ:function(){var a=this.y;return this.y=this.z,this.z=a,this},project:function(a){var b=a.project(this);return this.x=b.x,this.y=b.y,this.z=b.z,this},toRhinoPythonScript:function(){return"["+this.x.toFixed(2)+","+this.y.toFixed(2)+","+this.z.toFixed(2)+"]"},toRhinoPythonScriptArray:function(a){var b="	"+a+".append("+this.toRhinoPythonScript()+")\n";return b}},RIPSAW.DragNode=function(a,b,c,d,e,f){return this.temp=a instanceof RIPSAW.Vector?new RIPSAW.Vector(a.x,a.y,a.z):new RIPSAW.Vector(a,b,c),this.perm=this.temp.clone(),this.constraints=new RIPSAW.Vector(d||1,e||1,f||1),this},RIPSAW.DragNode.prototype={constructor:RIPSAW.DragNode,update:function(){return this.perm=this.temp.clone(),this},revert:function(){return this.temp=this.perm.clone(),this},setDrag:function(a){return this.temp=this.perm.clone(a.getProduct(this.constraints)),this},getDrag:function(){return this.temp.clone().subtract(this.perm)},clone:function(){return new RIPSAW.DragNode(this.perm.x,this.perm.y,this.perm.z,this.constraints.x,this.constraints.y,this.constraints.z)}},RIPSAW.PointCloud=function(){this._list=[];var a,b,c,d;if(arguments[0]instanceof Array)for(b=arguments[0],d=0,c=b.length;c>d;d+=1)a=b[d],this._list.push(new RIPSAW.Vector(a.x||0,a.y||0,a.z||0));return this},RIPSAW.PointCloud.prototype={addPoint:function(a){return this._list.push(a),this},getPoint:function(a){return this._list[a]},getPointCount:function(){return this._list.length},sortX:function(){return this._list.sort(function(a,b){return a.x>b.x?1:-1}),this},sortY:function(){return this._list.sort(function(a,b){return a.y>b.y?1:-1}),this},sortZ:function(){return this._list.sort(function(a,b){return a.z>b.z?1:-1}),this},getBoundingBox:function(){var a,b,c=-5e3,d=5e3,e=-5e3,f=5e3,g=-5e3,h=5e3,i=this._list.length;for(a=0;i>a;a+=1)b=this.getPoint(a),b.x>c&&(c=b.x),b.y>e&&(e=b.y),b.z>g&&(g=b.z),b.x<d&&(d=b.x),b.y<f&&(f=b.y),b.z<h&&(h=b.z);return{min:new RIPSAW.Vector(d,f,h),max:new RIPSAW.Vector(c,e,g)}},interpolateX:function(a){var b,c,d,e=this._list.length,f=[];for(b=0;e-1>b;b+=1)c=this._list[b],d=this._list[b+1],(c.x===a||d.x===a||c.x<a&&d.x>a||c.x>a&&d.x<a)&&f.push(new RIPSAW.Line(c,d).interpolateX(a));return f},getLength:function(){var a,b=this._list.length,c=0;for(a=0;b-1>a;a+=1)c+=this._list[a].getDistanceTo(this._list[a+1]);return c},getClosedLength:function(){return this.getLength()+this._list[this._list.length-1].getDistanceTo(this._list[0])},draw:function(a){var b,c=this.getPointCount(),d=a||function(a){return a};for(RIPSAW.pen.start(),RIPSAW.pen.moveTo(d(this.getPoint(0))),b=1;c>b;b+=1)RIPSAW.pen.lineTo(d(this.getPoint(b)));return RIPSAW.pen.end(),this},toSVG:function(){var a,b,c=this.getPointCount(),d='<polyline fill="none" stroke="black" stroke-linecap="round" stroke-linejoin="round" points = "';for(a=0;c>a;a+=1)b=this.getPoint(a),d+=b.x.toFixed(6)+","+b.y.toFixed(6)+" ";return d+='" />'}},RIPSAW.Line=function(a,b){return this.p1=a.clone(),this.p2=b.clone(),this},RIPSAW.Line.prototype={pointAt:function(a){var b=this.p1.x*(1-a)+this.p2.x*a,c=this.p1.y*(1-a)+this.p2.y*a,d=this.p1.z*(1-a)+this.p2.z*a;return new RIPSAW.Vector(b,c,d)},hasInBoundingRectangleXY:function(a){return a.x>=Math.min(this.p1.x,this.p2.x)&&a.x<=Math.max(this.p1.x,this.p2.x)&&a.y>=Math.min(this.p1.y,this.p2.y)&&a.y<=Math.max(this.p1.y,this.p2.y)},draw:function(){var a="undefined"!=typeof arguments[0]?arguments[0]:function(a){return a};return RIPSAW.line(a(this.p1),a(this.p2)),this},reverse:function(){var a=this.p1;return this.p1=this.p2,this.p2=a,this},getEquationXY:function(){var a,b,c;return this.p1.x===this.p2.x?(a=1,b=0,c=-this.p1.x):(a=(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x),b=-1,c=this.p2.y-a*this.p2.x),{a:a,b:b,c:c}},getMidPerpXY:function(){var a=this.p1.clone().subtract(this.p2),b=this.p1.clone().scale(.5).add(this.p2.clone().scale(.5));return a.crossMultiply(new RIPSAW.Vector(0,0,1)).normalize(),new RIPSAW.Line(b,b.clone().add(a))},scale:function(a){var b=this.p2.clone().subtract(this.p1).scale(a);return this.p2=this.p1.clone().add(b),this},getDistanceFromXY:function(a){var b=this.getEquationXY(),c=Math.pow(Math.pow(b.a,2)+Math.pow(b.b,2)+Math.pow(b.c,2),.5);return Math.abs(b.a*a.x+b.b*a.y+b.c)/c},interpolateX:function(a){var b,c;return RIPSAW.areNearEqual(this.p1.x,this.p2.x)?this.p1.clone():(b=(a-this.p1.x)/(this.p2.x-this.p1.x),c=this.p1.clone().scale(1-b),c.add(this.p2.clone().scale(b)),c)},intersectXY:function(a,b){var c,d,e,f,g,h,i=this,j="undefined"==typeof b?RIPSAW.delta2:b;return c=new RIPSAW.Matrix(2,2).populate(+(i.p2.x-i.p1.x),-(a.p2.x-a.p1.x),+(i.p2.y-i.p1.y),-(a.p2.y-a.p1.y)),Math.abs(c.determinant())<RIPSAW.delta?this.getDistanceFromXY(a.p1)<j?i.hasInBoundingRectangleXY(a.p1)||i.hasInBoundingRectangleXY(a.p2)?(h=new RIPSAW.PointCloud([this.p1.clone(),this.p2.clone(),a.p1.clone(),a.p2.clone()]).sortX().sortY(),{points:[h.getPoint(1).clone(),h.getPoint(2).clone()],type:"overlap"}):{points:[],type:"outerlap"}:{points:[],type:"parallel"}:(d=new RIPSAW.Matrix(2,1).populate(a.p1.x-i.p1.x,a.p1.y-i.p1.y),e=c.clone().inverse().multiply(d),f=e.table[0][0],g=e.table[1][0],{points:[i.pointAt(f)],type:f>=0&&1>=f&&g>=0&&1>=g?"inside":"outside",s1:f,s2:g})},getAngleXY:function(){var a,b=this.p1,c=this.p2;return Math.abs(b.x-c.x)<1e-5&&c.y>b.y?Math.PI/2:Math.abs(b.x-c.x)<1e-5&&c.y<b.y?3*Math.PI/2:(a=Math.atan((c.y-b.y)/(c.x-b.x)),b.x<c.x?0>a?a+2*Math.PI:a:a+Math.PI)},toSVG:function(){var a='<line fill="none" stroke="black" stroke-linecap="round" stroke-linejoin="round" ';return a+='x1 = "'+this.p1.x.toFixed(6)+'" ',a+='y1 = "'+this.p1.y.toFixed(6)+'" ',a+='x2 = "'+this.p2.x.toFixed(6)+'" ',a+='y2 = "'+this.p2.y.toFixed(6)+'" ',a+="/>"},toRhinoPythonScript:function(){return"rs.AddLine("+this.p1.toRhinoPythonScript()+", "+this.p2.toRhinoPythonScript()+")"},clone:function(){return new RIPSAW.Line(this.p1.clone(),this.p2.clone())}},RIPSAW.Camera=function(a,b,c,d){return this.r=this.rT="undefined"!=typeof a?a:1,this.theta=this.thetaT="undefined"!=typeof b?b:Math.PI/3,this.phi=this.phiT="undefined"!=typeof c?c:-Math.PI/4,this.f="undefined"!=typeof d?d:.6,this.eye=new RIPSAW.Vector,this.v1=new RIPSAW.Vector(1,0,0),this.v2=new RIPSAW.Vector(0,1,0),this.v3=new RIPSAW.Vector(0,0,1),this.buildEye(),this},RIPSAW.Camera.prototype={buildEye:function(){return this.eye=new RIPSAW.Vector(this.rT*Math.cos(this.thetaT)*Math.cos(this.phiT),this.rT*Math.sin(this.thetaT)*Math.cos(this.phiT),this.rT*Math.sin(this.phiT)).normalize(),this.v1=this.eye.clone().scale(-1),this.v2=this.v1.clone().crossMultiply(new RIPSAW.Vector(0,0,1)).normalize(),this.v3=this.v2.clone().crossMultiply(this.v1),this},update:function(){return this.r=this.rT,this.theta=this.thetaT,this.phi=this.phiT,this},revert:function(){return this.rT=this.r,this.thetaT=this.theta,this.phiT=this.phi,this.buildEye(),this},project:function(a){var b,c,d,e=this.eye.clone().subtract(a);return b=e.dotProduct(this.v2),c=e.dotProduct(this.v3),d=e.dotProduct(this.v1),new RIPSAW.Vector(b*this.f/d,c*this.f/d,0)},constrainViewHeight:function(){var a=80*Math.PI/180;return this.phiT<-a&&(this.phiT=-a),this.phiT>+a&&(this.phiT=+a),this},setDrag:function(){var a=RIPSAW.mouse.getDrag();return this.thetaT=this.theta-a.x/RIPSAW.minWH*2,this.phiT=this.phi-a.y/RIPSAW.minWH*2,this},mouseDrag:function(){return this.setDrag().constrainViewHeight().buildEye(),this},mouseMove:function(){return"3dpreview"===RIPSAW.mode&&RIPSAW.mouse.isDragging&&this.setDrag().constrainViewHeight().buildEye(),this},mouseUp:function(){return this.update(),this},mouseDown:function(){return this}},RIPSAW.colors={schemes:{purple:[[61,56,79],[247,141,52],[203,168,114],[61,103,196],[95,52,247],[61,103,196],[95,90,113],[255,255,255]],bw:[[255,255,255],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]},activeScheme:"purple",get:function(a,b){var c=this.schemes[this.activeScheme][a];return"rgba("+c[0]+","+c[1]+","+c[2]+","+b+")"},getBetween:function(a,b,c,d){var e=this.schemes[this.activeScheme],f=[e[a][0]*c+e[b][0]*(1-c),e[a][1]*c+e[b][1]*(1-c),e[a][2]*c+e[b][2]*(1-c)];return"rgba("+Math.round(f[0])+","+Math.round(f[1])+","+Math.round(f[2])+","+d+")"}},RIPSAW.pen={displayDimensions:{nav:{outline:.002,buttonSize:.03}},styles:{"design outline":{dim:.005,strokeColor:7,fillColor:1},"design iso":{dim:.002,strokeColor:7,fillColor:1},"design thin":{dim:.001,strokeColor:7,fillColor:1},"nav bounding box":{dim:.002,strokeColor:6},"design handle":{dim:1/300,strokeColor:7,fillColor:1},"control point":{dim:.01,strokeColor:1,fillColor:5},"primary control point":{dim:.01,strokeColor:1,fillColor:4},"secondary control point":{dim:.01,strokeColor:1,fillColor:5},point:{dim:1/150,strokeColor:1,fillColor:2}},configure:function(a){var b=RIPSAW.pen.styles[a];RIPSAW.pen.stroke(b.dim||.01),RIPSAW.pen.radius(b.dim),RIPSAW.pen.color.stroke(b.strokeColor||1),RIPSAW.pen.color.fill(b.fillColor||1)},solidRect:function(a,b,c,d){RIPSAW.ctx.beginPath(),RIPSAW.ctx.rect(a,b,c,d),RIPSAW.ctx.closePath(),RIPSAW.ctx.fill()},write:function(a,b,c,d,e,f){RIPSAW.ctx.fillStyle=RIPSAW.colors.get(e,f),RIPSAW.ctx.font=""+RIPSAW.W*RIPSAW.wDisplay.text*d+"px "+RIPSAW.fonts,RIPSAW.ctx.fillText(a,RIPSAW.W*b,RIPSAW.H*c)},start:function(){RIPSAW.ctx.beginPath()},end:function(){RIPSAW.ctx.stroke()},moveTo:function(a){RIPSAW.ctx.moveTo(a.x,a.y)},lineTo:function(a){RIPSAW.ctx.lineTo(a.x,a.y)},line:function(a,b){this.start(),this.moveTo(a),this.lineTo(b),this.end()},arc:function(a,b,c){b>0&&(this.start(),RIPSAW.ctx.arc(a.x,a.y,b,c.theta1,c.theta2),this.end())},splineTo:function(a,b,c){RIPSAW.ctx.bezierCurveTo(a.x,a.y,b.x,b.y,c.x,c.y)},solidCircle:function(a,b){b="undefined"==typeof b?RIPSAW.defaultRadius:b*RIPSAW.minWH,RIPSAW.ctx.beginPath(),RIPSAW.ctx.arc(a.x,a.y,b,0,2*Math.PI,!0),RIPSAW.ctx.fill()},controlPoint:function(a,b){var c=RIPSAW.defaultRadius;c=b?2*c:c,RIPSAW.pen.solidCircle(a,c)},stroke:function(a){RIPSAW.ctx.lineWidth=a*RIPSAW.minWH},radius:function(a){RIPSAW.defaultRadius=a},color:{stroke:function(a,b){RIPSAW.ctx.strokeStyle=RIPSAW.colors.get(a,b||1)},fill:function(a,b){RIPSAW.ctx.fillStyle=RIPSAW.colors.get(a,b||1)}},animateCircle:function(a,b,c,d,e,f,g){var h,i;RIPSAW.time-RIPSAW.time0>=f&&RIPSAW.time-RIPSAW.time0<=g&&(i=(g-RIPSAW.time+RIPSAW.time0)/(g-f),h=b*i+c*(1-i),RIPSAW.ctx.strokeStyle=RIPSAW.colors.getBetween(d,e,i,i),RIPSAW.ctx.lineWidth=RIPSAW.minWH/200,RIPSAW.pen.arc(RIPSAW.map(a),h*RIPSAW.minWH,{theta1:0,theta2:2*Math.PI}))},boundingBox:function(a,b,c){var d=a.x,e=a.y,f=b.x,g=b.y;RIPSAW.pen.line({x:d+c,y:e},{x:d+f-c,y:e}),RIPSAW.pen.line({x:d+f,y:e+c},{x:d+f,y:e+g-c}),RIPSAW.pen.line({x:d+f-c,y:e+g},{x:d+c,y:e+g}),RIPSAW.pen.line({x:d,y:e+g-c},{x:d,y:e+c}),RIPSAW.pen.arc({x:d+c,y:e+c},c,{theta1:1*Math.PI,theta2:1.5*Math.PI}),RIPSAW.pen.arc({x:d+f-c,y:e+c},c,{theta1:1.5*Math.PI,theta2:2*Math.PI}),RIPSAW.pen.arc({x:d+c,y:e+g-c},c,{theta1:Math.PI/2,theta2:1*Math.PI}),RIPSAW.pen.arc({x:d+f-c,y:e+g-c},c,{theta1:2*Math.PI,theta2:2.5*Math.PI})}},RIPSAW.mouse=function(){var a={},b=0,c=0,d=0,e=0;return a=RIPSAW.observer(),a.isDragging=!1,a.getPosition=function(a){var d=RIPSAW.canvas.getBoundingClientRect();b=a.clientX-d.left,c=a.clientY-d.top},a.getDrag=function(){return new RIPSAW.Vector(b-d,c-e,0)},a.getNormalizedDrag=function(){return this.getDrag().product(new RIPSAW.Vector(1/RIPSAW.W,1/RIPSAW.H))},a.distanceTo=function(a){return new RIPSAW.Vector(b,c).getDistanceTo(a)},a.hovers=function(a){return this.distanceTo(a)<RIPSAW.minWH*RIPSAW.tolerance},a.positionTo=function(a){return new RIPSAW.Vector(b-a.x,c-a.y)},a.update=function(a,f){this.getPosition(a),"down"===f?(this.isDragging=!0,d=b,e=c):"up"===f&&(this.isDragging=!1)},a.down=function(a){return this.update(a,"down"),this.obs.fire("mouseDown"),this},a.up=function(a){return this.update(a,"up"),this.obs.fire("mouseDown"),this},a.move=function(a){return this.update(a,"move"),this.obs.fire("mouseMove"),this},a}(),RIPSAW.stage=function(){var a={};return a=RIPSAW.observer(),a.no=0,a.update=function(){return this.fire("stageUpdate"),RIPSAW.time0=RIPSAW.time,this},a.change=function(a){return this.no=Math.round(10*(this.no+a))/10,this.update(),this},a.set=function(a){return this.no=Math.round(10*a)/10,this.update(),this},a}(),RIPSAW.tutorial={x:.5,dx:0,y:.75,dy:.05,text:[],place:function(){if("undefined"!=typeof text){var a,b=text.length;for(a=0;b>a;a+=1)RIPSAW.pen.write(this.text[a],this.x+a*this.dx,this.y+a*this.dy,1,2,1)}},stageUpdate:function(){this.text=this.stageManager[RIPSAW.stage.no]}},RIPSAW.MenuButton=function(a,b,c,d){this.name=c,this.isActive=!1,this.x=a,this.y=b,this.w=RIPSAW.wDisplay.navButton,this.h=RIPSAW.wDisplay.navButton,this.damping=.03,this.opacity=.4,this.targetOpacity={"true":1,"false":.4},this.animate=d||!1},RIPSAW.MenuButton.prototype={isHovered:function(){var a=RIPSAW.mouse.positionTo(RIPSAW.map(this));return Math.abs(a.x)<this.w*RIPSAW.maxWH/2&&Math.abs(a.y)<this.h*RIPSAW.W/2},setDisplayOpacity:function(){return this.opacity+=(this.targetOpacity[this.isActive]-this.opacity)*this.damping,RIPSAW.ctx&&(RIPSAW.ctx.globalAlpha=this.opacity),this},animateMarkingCircle:function(){return RIPSAW.ctx.globalAlpha=1,this.animate&&RIPSAW.pen.animateCircle(this,.05,.12,2,0,RIPSAW.anim.delay,RIPSAW.anim.delay+500),this},place:function(){return this.setDisplayOpacity(),RIPSAW.ctx.drawImage(RIPSAW.allButtons[this.name].image,RIPSAW.map(this).x-this.w*RIPSAW.maxWH/2,RIPSAW.map(this).y-this.h*RIPSAW.maxWH/2,this.w*RIPSAW.maxWH,this.h*RIPSAW.maxWH),this.animateMarkingCircle(),this}},RIPSAW.Navigation=function(a){this.buttons=[],this.buttonGroups=[],this.hoverIndex=-1,this.displayHelp=!0,this.helpX=.5,this.helpY=.5,this.defaultMode="mode2","undefined"!=typeof a&&this.build(a)},RIPSAW.Navigation.prototype={build:function(a){var b,c;if(this.displayHelp=a.displayHelp||!0,this.defaultMode=a.defaultMode||"mode2",this.helpX=a.xHelp||.5,this.helpY=a.yHelp||.5,this.buttons=[],this.buttonGroups=[],"undefined"!=typeof a){for(b=0,c=a.buttons.length;c>b;b+=1)this.buttons.push(new RIPSAW.MenuButton(a.buttons[b].x,a.buttons[b].y,a.buttons[b].name,a.buttons[b].animate));this.buttonGroups=a.buttonGroups||[]}},mouseDown:function(){-1!==this.hoverIndex&&"undefined"!=typeof this.hoverIndex&&RIPSAW.allButtons[this.buttons[this.hoverIndex].name].onClick()},mouseMove:function(){var a,b=this.buttons.length;for(this.hoverIndex=-1,a=0;b>a;a+=1)this.buttons[a].isHovered()?(this.hoverIndex=a,this.buttons[a].isActive=!0):this.buttons[a].isActive=!1,this.buttons[a].name===RIPSAW.mode&&(this.buttons[a].isActive=!0);return this},placeButtons:function(){var a,b=this.buttons.length;for(a=0;b>a;a+=1)this.buttons[a].place();return this},placeHelp:function(){return this.displayHelp&&-1!==this.hoverIndex&&"undefined"!=typeof this.buttons[this.hoverIndex]&&RIPSAW.pen.write(RIPSAW.allButtons[this.buttons[this.hoverIndex].name].helpText,this.helpX,this.helpY,1,2,(this.buttons[this.hoverIndex].opacity-.4)/.6),this},getButtonGroupBoundaries:function(a){var b,c,d,e=this.buttonGroups[a],f=e.length,g=-5e3,h=-5e3,i=5e3,j=5e3;for(b=0;f>b;b++)c=this.buttons[e[b]].x,d=this.buttons[e[b]].y,c>g&&(g=c),d>h&&(h=d),i>c&&(i=c),j>d&&(j=d);return{min:new RIPSAW.Vector(i,j),max:new RIPSAW.Vector(g,h)}},placeBoundingBoxes:function(){var a,b,c,d,e,f,g;for(a=0,b=this.buttonGroups.length;b>a;a+=1)g=this.getButtonGroupBoundaries(a),c=g.min,d=g.max.subtract(g.min),e=RIPSAW.wDisplay.navButton*RIPSAW.W*1.3,f=.025*RIPSAW.minWH,RIPSAW.pen.boundingBox(RIPSAW.map(c).subtract(new RIPSAW.Vector(e/2,e/2)),RIPSAW.map(d).add(new RIPSAW.Vector(e,e)),f);return this},draw:function(){this.placeButtons(),this.placeHelp(),RIPSAW.pen.configure("nav bounding box"),this.placeBoundingBoxes()},stageUpdate:function(){var a=this.stageManager[RIPSAW.stage.no];return"undefined"!=typeof a&&(this.build(a),RIPSAW.mode=this.defaultMode),this}},RIPSAW.nav=new RIPSAW.Navigation,RIPSAW.MasterPiece=function(a,b,c){this.name="object",this.centroid=new RIPSAW.DragNode(a||.5,b||.5),this.scale=c||1,this.allow=new RIPSAW.MasterPiecePermissions("11000"),this.stageManager={},this.control=[],this.hoverIndex=-1},RIPSAW.MasterPiece.prototype={map:function(a){return new RIPSAW.Vector(this.centroid.temp.x*RIPSAW.W+a.x*RIPSAW.minWH*this.scale,this.centroid.temp.y*RIPSAW.H+a.y*RIPSAW.minWH*this.scale,0)},updateState:function(a){return"undefined"!=typeof a&&(this.allow.setBinaryString(a.permissionsBinary||"0"),this.centroid=new RIPSAW.DragNode(a.x0||.5,a.y0||.5),this.scale=a.scale||1),this},getObjectDrag:function(){return RIPSAW.mouse.getDrag().getProduct(new RIPSAW.Vector(1/RIPSAW.minWH/this.scale,1/RIPSAW.minWH/this.scale))}},RIPSAW.MasterPiecePermissions=function(a){return this.permissionList=["draw","edit","pan","zoom","rotate"],this.setBinaryString(a||"11000"),this},RIPSAW.MasterPiecePermissions.prototype={getByIndex:function(a){return this[this.permissionList[a]]},setByIndex:function(a,b){return this[this.permissionList[a]]=b,this},setBinaryString:function(a){var b,c=this.permissionList.length;for(a="[object String]"===Object.prototype.toString.call(a)?a:"0",b=0;c>b;b+=1)this[this.permissionList[b]]="1"===a.charAt(b);return this}},RIPSAW.BezierSVGPath=function(a){return this.raw=a,this},RIPSAW.BezierSVGPath.prototype={chop:function(){var a,b,c=this.raw,d=this.raw.length,e="",f="";for(b=[],a=0;d>a;a+=1)e=c.charAt(a),/[mMcCsSz]/.test(e)?(""!==f&&b.push(parseFloat(f)),b.push(e),f=""):","===e?(""!==f&&b.push(parseFloat(f)),f=""):"-"===e?(""!==f&&b.push(parseFloat(f)),f="-"):f+=e;return""!==f&&b.push(parseFloat(f)),b},vectorize:function(){var a,b,c,d,e=this.chop(),f=[],g=e.length,h=0;for(a=0;g>a;a+=1)d=e[a],/[mMcCsSz]/.test(d)?f.push(d):(h%2===0?b=d:(c=d,f.push(new RIPSAW.Vector(b,c))),h+=1);return f},absolutize:function(){var a,b=this.vectorize(),c=-1,d=b.length;for(a=0;d>a;a+=1)/[cs]/.test(b[a])?(c=a,b[a]=b[a].toUpperCase()):/[CS]/.test(b[a])?c=-1:-1!==c&&b[a].add(b[c-1]);return b},ridS:function(){var a,b=this.absolutize(),c=b.length,d=[];for(a=0;c>a;a+=1)"S"===b[a]?(d.push("C"),d.push(b[a-1].clone().scale(2).subtract(b[a-2]))):d.push(b[a]);return d},toBezierHandles:function(a){var b,c,d,e,f,g=this.ridS(),h=g.length,i=[];for("undefined"==typeof a&&(b=!0),c=2;h-1>c;c+=1)"C"===g[c]&&(d=2===c&&b?g[h-3]:2!==c||b?g[c-2]:g[c-1],e=g[c-1],f=g[c+1],i.push(new RIPSAW.BezierHandle(d,e,f)));return b||(d=g[h-2],e=g[h-1],f=g[h-1],i.push(new RIPSAW.BezierHandle(d,e,f))),i}},RIPSAW.BezierHandle=function(a,b,c){return this.p=[new RIPSAW.DragNode(a),new RIPSAW.DragNode(b),new RIPSAW.DragNode(c)],this.n=20,this.hoverType=-1,this.constraint=new RIPSAW.Vector(1,1,1),this},RIPSAW.BezierHandle.prototype={toString:function(){return output+="["+this.p[0].perm.x+", "+this.p[0].perm.y+"] - ",output+="["+this.p[1].perm.x+", "+this.p[1].perm.y+"] - ",output+="["+this.p[2].perm.x+", "+this.p[2].perm.y+"]",output+="\n",output},update:function(){return this.p[0].update(),this.p[1].update(),this.p[2].update(),this},clone:function(){return new RIPSAW.BezierHandle(new RIPSAW.DragNode(this.p[0].perm.x,this.p[0].perm.y,this.p[0].perm.z),new RIPSAW.DragNode(this.p[1].perm.x,this.p[1].perm.y,this.p[1].perm.z),new RIPSAW.DragNode(this.p[2].perm.x,this.p[2].perm.y,this.p[2].perm.z))},revert:function(){this.p[0].revert(),this.p[1].revert(),this.p[2].revert()},getHandleLengths:function(){return{temp:[this.p[0].temp.getDistanceTo(this.p[1].temp),this.p[2].temp.getDistanceTo(this.p[1].temp)],perm:[this.p[0].perm.getDistanceTo(this.p[1].perm),this.p[2].perm.getDistanceTo(this.p[1].perm)]}},setHandleLength:function(a,b){var c,d;return c=1-b/this.getHandleLengths().temp[a],Math.abs(c)<10&&(d=this.p[1].temp.clone(),d.subtract(this.p[2*a].temp),d.scale(c),this.p[2*a].temp.add(d)),this},preserveHandleLength:function(a){var b=this.getHandleLengths().perm[a];return this.setHandleLength(a,b),this},smooth:function(){var a,b,c=this.p[2].temp.x-this.p[0].temp.x,d=this.p[2].temp.y-this.p[0].temp.y;return a=0===c?100:d/c,b=this.p[2].temp.x>this.p[1].temp.x?1:-1,this.p[2].temp=this.p[1].temp.clone().add(new RIPSAW.Vector(+b,+b*a)),this.p[0].temp=this.p[1].temp.clone().add(new RIPSAW.Vector(-b,-b*a)),this.preserveHandleLength(0),this.preserveHandleLength(1),this.update(),this},drawControlHandles:function(a){a=a||function(a){return a},RIPSAW.pen.line(a(this.p[1].temp),a(this.p[0].temp)),RIPSAW.pen.line(a(this.p[1].temp),a(this.p[2].temp))},drawControlPoints:function(a){a=a||function(a){return a},RIPSAW.pen.controlPoint(a(this.p[0].temp),this.hoverType===i)},setDrag:function(a){var b,c=this.getHandleLengths().temp,d=this.hoverType,e=a.clone().product(this.constraint);if(-1!==d)switch(d){case 1:this.p[1].setDrag(e),this.p[0].setDrag(e),this.p[2].setDrag(e);break;case 0:case 2:this.p[d].setDrag(a),/mode[2-3]/.test(RIPSAW.mode)&&(b=c[(2-d)/2]/c[d/2],Math.abs(b)<10&&(this.p[2-d].setDrag(a.product(new RIPSAW.Vector(-b,-b))),/mode2/.test(RIPSAW.mode)&&this.preserveHandleLength((2-d)/2)))}return this},toRhinoPythonScript:function(){}},RIPSAW.Bezier2D=function(a){return RIPSAW.MasterPiece.call(this),this.theta=0,this.isClosed=!0,this.control="string"==typeof a?new RIPSAW.BezierSVGPath(a).toBezierHandles():a,this},RIPSAW.Bezier2D.prototype={toString:function(){var a,b=this.control.length,c="";for(a=0;b>a;a+=1)c+=this.control[a].toString();
return c},addControlPoint:function(a){this.control.push(a)},createDepthProfile:function(a,b){var c,d=b||3,e=a||.1;for(this.control=[],c=0;d>c;c+=1)this.control.push(new RIPSAW.BezierHandle(new RIPSAW.Vector((c-.3)/(d-1)-.5,e,0),new RIPSAW.Vector((c+0)/(d-1)-.5,e,0),new RIPSAW.Vector((c+.3)/(d-1)-.5,e,0)));return this.constrainEnds(new RIPSAW.Vector(0,1,1)),this.n=15,this.isClosed=!1,this},getBoundingRectangle:function(){var a,b,c=-5e3,d=-5e3,e=5e3,f=5e3,g=this.control.length;for(a=0;g>a;a+=1)b=this.control[a],c=Math.max(c,b.p[0].temp.x,b.p[1].temp.x,b.p[2].temp.x),e=Math.min(e,b.p[0].temp.x,b.p[1].temp.x,b.p[2].temp.x),d=Math.max(d,b.p[0].temp.y,b.p[1].temp.y,b.p[2].temp.y),f=Math.min(f,b.p[0].temp.y,b.p[1].temp.y,b.p[2].temp.y);return{min:new RIPSAW.Vector(e,f),max:new RIPSAW.Vector(c,d)}},getCentroid:function(){var a=this.getBoundingRectangle();return new RIPSAW.Vector((a.max.x+a.min.x)/2,(a.max.y+a.min.y)/2)},getMaxDim:function(){var a=this.getBoundingRectangle();return Math.max(a.max.x-a.min.x,a.max.y-a.min.y)},moveGeometry:function(a){var b,c,d=this.control.length;for(b=0;d>b;b+=1)c=this.control[b],c.p[0].temp.add(a),c.p[0].update(),c.p[1].temp.add(a),c.p[1].update(),c.p[2].temp.add(a),c.p[2].update();return this},scaleGeometry:function(a){var b,c,d=this.control.length,e=a||1;for(b=0;d>b;b+=1)c=this.control[b],c.p[0].temp.scale(e),c.p[0].update(),c.p[1].temp.scale(e),c.p[1].update(),c.p[2].temp.scale(e),c.p[2].update();return this},normalize:function(){var a,b;return a=this.getCentroid(),b=1/this.getMaxDim(),this.moveGeometry(a.scale(-1)).scaleGeometry(b),this},constrainEnds:function(a){a||new RIPSAW.Vector(1,1,1);return this.control[0].constraint=a,this.control[this.control.length-1].constraint=a,this},isClosed:function(){return 0===this.control.length?!1:this.control[0].p[1].perm.isNearEqualTo(this.control[this.control.length-1].p[1].perm)},setSubdivisions:function(a){var b,c,d,e=0,f=[];for(d=0,b=this.control.length;b>d;d+=1)c=this.getSegmentLength(d),f.push(c),c>e&&(e=c);for(d=0,b=this.control.length;b>d;d+=1)this.control[d].n=Math.floor(f[d]/e*a);return this},getSegmentLength:function(a,b){var c,d=0,e=b||10;for(c=0;e>c;c+=1)p1=this.getPoint(a,c/e),p2=this.getPoint(a,(c+1)/e),d+=p1.getDistanceTo(p2);return d},getPoint:function(a,b){var c,d,e,f,g=a===this.control.length-1?0:a+1;return c=this.control[a].p[1].temp,d=this.control[a].p[2].temp,e=this.control[g].p[0].temp,f=this.control[g].p[1].temp,(new RIPSAW.Vector).getLinearCombination([c,d,e,f],[Math.pow(1-b,3)*Math.pow(b,0),Math.pow(1-b,2)*Math.pow(b,1)*3,Math.pow(1-b,1)*Math.pow(b,2)*3,Math.pow(1-b,0)*Math.pow(b,3)])},getSubdivision:function(a){var b,c,d,e,f=new RIPSAW.PointCloud;for(b=this.isClosed?this.control.length:this.control.length-1,d=0;b>d;d+=1)for(c=a||this.control[d].n,e=0;c>e;e+=1)f.addPoint(this.getPoint(d,e/(c-1)));return f},placeSpline:function(){{var a,b=this.control.length;RIPSAW.pen.displayDimensions}for(RIPSAW.pen.start(),RIPSAW.pen.moveTo(this.map(this.control[0].p[1].temp)),a=1;b>a;a+=1)RIPSAW.pen.splineTo(this.map(this.control[a-1].p[2].temp),this.map(this.control[a].p[0].temp),this.map(this.control[a].p[1].temp));return this.isClosed&&RIPSAW.pen.splineTo(this.map(this.control[b-1].p[2].temp),this.map(this.control[0].p[0].temp),this.map(this.control[0].p[1].temp)),RIPSAW.pen.end(),this},placeControlHandles:function(){var a,b,c=this.control.length;for(a=0;c>a;a++)b=this.control[a],RIPSAW.pen.line(this.map(b.p[1].temp),this.map(b.p[0].temp)),RIPSAW.pen.line(this.map(b.p[1].temp),this.map(b.p[2].temp))},placeControlPoints:function(){var a,b,c,d=this.control.length;for(a=0;d>a;a++)for(c=this.control[a],b=0;3>b;b+=1)RIPSAW.pen.configure(1===b?"primary control point":"secondary control point"),RIPSAW.pen.controlPoint(this.map(c.p[b].temp),c.hoverType===b)},draw:function(){return this.allow.draw&&(RIPSAW.pen.configure("design outline"),this.placeSpline(),RIPSAW.pen.configure("design handle"),this.placeControlHandles(),RIPSAW.pen.configure("control point"),this.placeControlPoints()),this},clone:function(){var a,b=new RIPSAW.BezierObject([],this.theta,this.p0.x,this.p0.y,this.scale);for(a=0,max=this.control.length;a<max;a+=1)b.control.push(this.control[a].clone());return b},updateHoverState:function(){var a,b,c=this.control.length;for(this.hoverIndex=-1,a=0;c>a;a+=1)for(b=this.control[a],b.hoverType=-1,j=0;j<=2;j+=1)RIPSAW.mouse.hovers(this.map(b.p[j].perm))&&(this.hoverIndex=a,b.hoverType=1!==b.hoverType?j:1);return this},mouseMove:function(){var a;return this.allow.edit&&(a=RIPSAW.mouse.getNormalizedDrag(),RIPSAW.mouse.isDragging?-1===this.hoverIndex&&this.allow.pan?this.centroid.setDrag(a):-1!==this.hoverIndex&&/mode[1-3]/.test(RIPSAW.mode)&&this.allow.edit&&(this.control[this.hoverIndex].setDrag(this.getObjectDrag()),RIPSAW.isModified=!0):this.updateHoverState()),this},mouseUp:function(){return-1!==this.hoverIndex?this.control[this.hoverIndex].update():this.centroid.update(),this},mouseDown:function(){return"smooth"===RIPSAW.mode&&-1!==this.hoverIndex&&this.control[this.hoverIndex].smooth(),this},toSVGPath:function(){var a,b,c,d,e=this.control.length,f=RIPSAW.rDim.l;for(b="M"+((this.control[0].p[1].perm.x+.5)*f).toFixed(2)+","+((this.control[0].p[1].perm.y+.5)*f).toFixed(2),a=0;e>a;a+=1)c=this.control[a],d=a===e-1?this.control[0]:this.control[a+1],b+="C"+((c.p[2].perm.x+.5)*f).toFixed(2)+","+((c.p[2].perm.y+.5)*f).toFixed(2)+","+((d.p[0].perm.x+.5)*f).toFixed(2)+","+((d.p[0].perm.y+.5)*f).toFixed(2)+","+((d.p[1].perm.x+.5)*f).toFixed(2)+","+((d.p[1].perm.y+.5)*f).toFixed(2);return b+="z"},toDB:function(){return this.toSVGPath()},fromDB:function(a){return this.control=new RIPSAW.BezierSVGPath(a).toBezierHandles(),this},toSVG:function(){var a="";return a=RIPSAW.textAssets.SVGHeader,a+='<path style="fill:none;stroke-width:4;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;" ',a+='d="'+this.toSVGPath()+'">',a+=RIPSAW.textAssets.SVGFooter},toRhinoPythonScript:function(a,b,c){var d,e,f,g,h="",i=RIPSAW.rDim.l,j=new RIPSAW.Vector(1.02,1,1/RIPSAW.rDim.depthScale),k=function(a){var b,c=a.length,d="";for(b=0;c>b;b+=1)d+="pts["+a[b]+"]",c-1>b&&(d+=",");return d};for(h+='\n	rs.AddLayer("'+a+'")\n',h+='	rs.CurrentLayer("'+a+'")\n',h+="\n	pts = []",h+="\n	"+a+"_crvs = []\n\n",e=0,f=this.control.length;f>e;e+=1)g=this.control[e],c?(h+=g.p[0].perm.clone().scale(i).toRhinoPythonScriptArray("pts"),h+=g.p[1].perm.clone().scale(i).toRhinoPythonScriptArray("pts"),h+=g.p[2].perm.clone().scale(i).toRhinoPythonScriptArray("pts")):(h+=g.p[0].perm.clone().swapYZ().scale(i).product(j).toRhinoPythonScriptArray("pts"),h+=g.p[1].perm.clone().swapYZ().scale(i).product(j).toRhinoPythonScriptArray("pts"),h+=g.p[2].perm.clone().swapYZ().scale(i).product(j).toRhinoPythonScriptArray("pts"));for(e=0,f=this.control.length;f>e;e+=1)d="",e<this.control.length-1?(d=k([3*e+1,3*e+2,3*e+3,3*e+4]),h+="\n	"+a+"_crvs.append(rs.AddCurve(["+d+"]))"):this.isClosed&&(d=k([3*e+1,3*e+2,0,1]),h+="\n	"+a+"_crvs.append(rs.AddCurve(["+d+"]))");return h+="\n\n	"+a+"=rs.JoinCurves("+a+"_crvs, True);\n\n",h+="\n	"+a+"_extrudePath1 = rs.AddLine([0,0,0],"+(c?"[0,0,"+-i/2+"]":"[0,"+-i/2+",0]")+")",h+="\n	"+a+"_extrudePath2 = rs.AddLine([0,0,0],"+(c?"[0,0,"+i/2+"]":"[0,"+i/2+",0]")+")",h+="\n	"+a+"_srf1 = rs.ExtrudeCurve("+a+","+a+"_extrudePath1)",h+="\n	"+a+"_srf2 = rs.ExtrudeCurve("+a+","+a+"_extrudePath2)",h+="\n	"+a+"_srf = rs.JoinSurfaces(["+a+"_srf1,"+a+"_srf2], True)",h+="\n\n\n"}},RIPSAW.inheritPrototype(RIPSAW.MasterPiece,RIPSAW.Bezier2D),RIPSAW.Bezier3D=function(a,b){return RIPSAW.MasterPiece.call(this),this.plan=new RIPSAW.Bezier2D(a).normalize(),this.side=[(new RIPSAW.Bezier2D).createDepthProfile(+(b||.2)/2,3),(new RIPSAW.Bezier2D).createDepthProfile(-(b||.2)/2,3)],this.camera=new RIPSAW.Camera,this},RIPSAW.Bezier3D.prototype={set3DView:function(){return this.plan.allow=this.side[0].allow=this.side[1].allow={draw:!1,edit:!1},this.centroid=new RIPSAW.DragNode(.5,.5),this.scale=.8,this},setAllView:function(){return this.centroid=new RIPSAW.DragNode(.75,.4),this.plan.centroid=new RIPSAW.DragNode(.25,.25),this.side[0].centroid=new RIPSAW.DragNode(.25,.75),this.side[1].centroid=new RIPSAW.DragNode(.25,.75),this.scale=1,this.plan.scale=this.side[0].scale=this.side[1].scale=.55,this.allow=this.plan.allow=this.side[0].allow=this.side[1].allow={draw:!0,edit:!0},this.allow.rotate=!1,this},setPlanView:function(){this.allow=this.side[0].allow=this.side[1].allow={draw:!1,edit:!1},this.plan.centroid=new RIPSAW.DragNode(.5,.5),this.plan.scale=1},get3DOutline:function(a){var b,c,d,e,f,g=[this.side[0].getSubdivision(RIPSAW.mesh.n2),this.side[1].getSubdivision(RIPSAW.mesh.n2)],h=[this.plan.getSubdivision(RIPSAW.mesh.n2),this.plan.getSubdivision(RIPSAW.mesh.n2)];for(c=0;2>c;c+=1)for(d=h[c].getPointCount(),b=0;d>b;b+=1)e=h[c].getPoint(b),f=g[c].interpolateX(e.x)[0],"undefined"!=typeof f&&(e.z=f.y/RIPSAW.rDim.depthScale),e.project(this.camera).scale(a||1);return h},place3DIsoCurves:function(a,b){var c,d=a[0].getPointCount();for(b="undefined"!=typeof b?b:5,RIPSAW.pen.configure("design iso"),c=0;d>c;c+=b)RIPSAW.pen.line(this.map(a[0].getPoint(c)),this.map(a[1].getPoint(c)))},place3DOutline:function(a){var b,c=a[0].getPointCount();for(b=0;c-1>b;b+=1)RIPSAW.pen.line(this.map(a[0].getPoint(b)),this.map(a[0].getPoint(b+1))),RIPSAW.pen.line(this.map(a[1].getPoint(b)),this.map(a[1].getPoint(b+1)))},draw3D:function(){var a;this.allow.draw&&(a=this.get3DOutline(),RIPSAW.pen.configure("design outline"),this.place3DOutline(a),RIPSAW.pen.configure("design iso"),this.place3DIsoCurves(a))},draw:function(){return this.allow.draw&&this.draw3D(),this.plan.draw(),this.side[0].draw(),this.side[1].draw(),this},mouseMove:function(){this.allow.rotate&&this.camera.mouseMove(),this.plan.mouseMove(),this.side[0].mouseMove(),this.side[1].mouseMove()},mouseUp:function(){this.allow.rotate&&this.camera.mouseUp(),this.plan.mouseUp(),this.side[0].mouseUp(),this.side[1].mouseUp()},mouseDown:function(){this.allow.rotate&&this.camera.mouseDown(),this.plan.mouseDown(),this.side[0].mouseDown(),this.side[1].mouseDown()},toSVG:function(){var a,b="",c=this.get3DOutline(100),d=c[0].getPointCount();for(b+="	"+c[0].toSVG()+"\n	"+c[1].toSVG(),b+="\n	<g>",a=0;d>a;a+=5)b+="\n		"+new RIPSAW.Line(c[0].getPoint(a),c[1].getPoint(a)).toSVG();return b+="\n	</g>",RIPSAW.textAssets.SVGHeader+"\n"+b+"\n"+RIPSAW.textAssets.SVGFooter},toRhinoPythonScript:function(){var a=this.plan.toRhinoPythonScript("plan",1,!0)+this.side[0].toRhinoPythonScript("profileTop",2.1,!1)+this.side[1].toRhinoPythonScript("profileBottom",2.2,!1);return RIPSAW.textAssets.rhinoPythonScriptHeader+a+RIPSAW.textAssets.rhinoPythonScriptFooter},stageUpdate:function(){var a=this.stageManager[RIPSAW.stage.no];"undefined"!=typeof a&&(this.updateState(a.threeD),this.plan.updateState(a.plan),this.side[0].updateState(a.side),this.side[1].updateState(a.side))}},RIPSAW.inheritPrototype(RIPSAW.MasterPiece,RIPSAW.Bezier3D),RIPSAW.Pantograph=function(a,b,c,d,e,f){return RIPSAW.MasterPiece.call(this,d,e,f),this.n=a,this.l=b,this.c=c,this.d=this.l*this.c,this.hoverIndex=-1,this.control=[],this.initControl(),this},RIPSAW.Pantograph.prototype={setLegSpan:function(a){return this.d=a,this},initControl:function(){return this.control=[new RIPSAW.DragNode(this.d/2,0,0,1,0,0),new RIPSAW.DragNode(0,-this.getSegmentHeight(0)*this.c,0,0,1,0)],this},updateControl:function(){return this.control[0].temp.x=this.d/2,this.control[1].temp.y=-this.getSegmentHeight(0)*this.c,this},updateGeometry:function(){switch(this.hoverIndex){case 0:this.d=2*this.control[0].temp.x;break;case 1:this.l=Math.pow(Math.pow(this.control[1].temp.y,2)+Math.pow(this.d/2,2),.5)/this.c}return this},getSegmentHeight:function(a){var b=Math.pow((1-this.c)/this.c,a),c=this.l*b,d=this.d*b;return Math.pow(Math.pow(c*this.c,2)-Math.pow(d/2,2),.5)/this.c},getMembers:function(a){var b,c,d,e,f,g=this.l,h=this.d,j=0,k=[];for(i=0;i<this.n;i+=1)b=this.getSegmentHeight(i),c=new RIPSAW.Vector(-h/2,-j).scale(a),e=new RIPSAW.Vector(+h/2*(1-this.c)/this.c,-(j+b)).scale(a),d=new RIPSAW.Vector(+h/2,-j).scale(a),f=new RIPSAW.Vector(-h/2*(1-this.c)/this.c,-(j+b)).scale(a),k.push(new RIPSAW.Line(c,e)),k.push(new RIPSAW.Line(d,f)),h*=(1-this.c)/this.c,g*=(1-this.c)/this.c,j+=b;return k},placeMembers:function(){var a,b=this.getMembers(),c=b.length;for(a=0;c>a;a+=1)RIPSAW.pen.configure("design outline"),RIPSAW.pen.line(this.map(b[a].p1),this.map(b[a].p2));return this},placeControlPoints:function(){var a;for(a=0;a<this.control.length;a+=1)RIPSAW.pen.controlPoint(this.map(this.control[a].temp),this.hoverIndex===a);return this},draw:function(){return RIPSAW.pen.configure("design outline"),this.placeMembers(),RIPSAW.pen.configure("primary control point"),this.placeControlPoints(),this},hasValidLegSpan:function(){return Math.abs(this.d)<this.l},getTotalHeight:function(){var a=0;if(!this.hasValidLegSpan())return a;for(i=0;i<this.n;i+=1)a+=this.getSegmentHeight(i);return a},normalize:function(){var a=1/this.getTotalHeight();return this.l*=a,this.d*=a,this.updateControl(),this},updateHoverState:function(){var a,b=this.control.length;for(this.hoverIndex=-1,a=0;b>a;a+=1)RIPSAW.mouse.hovers(this.map(this.control[a].perm))&&(this.hoverIndex=a)},mouseMove:function(){return RIPSAW.mouse.isDragging?-1!==this.hoverIndex&&(this.control[this.hoverIndex].setDrag(this.getObjectDrag()),this.updateGeometry(),this.updateControl()):this.updateHoverState(),this},mouseUp:function(){return-1!==this.hoverIndex&&this.control[this.hoverIndex].update(),this},mouseDown:function(){return this},toSVG:function(){var a,b=this.getMembers(100),c=b.length,d="";for(a=0;c>a;a+=1)d+="	"+b[a].toSVG()+"\n";return RIPSAW.textAssets.SVGHeader+"\n"+d+RIPSAW.textAssets.SVGFooter}},RIPSAW.inheritPrototype(RIPSAW.MasterPiece,RIPSAW.Pantograph),RIPSAW.CurvingPantograph=function(a,b,c,d,e,f,g){return RIPSAW.MasterPiece.call(this,e,f,g),this.n=a,this.l=b,this.c1=c,this.c2=d,this.d=this.l*this.c1,this.hoverIndex=-1,this.control=[],this.initControl(),this},RIPSAW.CurvingPantograph.prototype={setLegSpan:function(a){return this.d=a,this},initControl:function(){return this.control=[new RIPSAW.DragNode(this.d/2,0,0,1,0,0)],this},updateControl:function(){return this.control[0].temp.x=this.d/2,this},updateGeometry:function(){return this.d=2*this.control[0].temp.x,this},getSegmentHeight:function(a){var b=Math.pow((1-this.c1)/this.c1,a),c=this.l*b,d=this.d*b;return Math.pow(Math.pow(c*this.c1,2)-Math.pow(d/2,2),.5)/this.c1},getMembers:function(a){var b,c,d,e,f,g=[],h=a||1,j=new RIPSAW.Vector(+this.d/2,0),k=new RIPSAW.Vector(-this.d/2,0);for(i=0;i<this.n;i+=1)f=new RIPSAW.Line(j,k),b=this.getSegmentHeight(i),e=f.getMidPerpXY().scale(b*this.c1).p2,d=new RIPSAW.Line(j,e).scale(1/this.c1).p2,c=new RIPSAW.Line(k,e).scale(1/this.c2).p2,g.push(new RIPSAW.Line(j.clone().scale(h),d.clone().scale(h))),g.push(new RIPSAW.Line(k.clone().scale(h),c.clone().scale(h))),j=c,k=d;return g},placeMembers:function(){var a,b=this.getMembers(),c=b.length;for(a=0;c>a;a+=1)RIPSAW.pen.configure("design outline"),RIPSAW.pen.line(this.map(b[a].p1),this.map(b[a].p2));return this},placeControlPoints:function(){var a;for(a=0;a<this.control.length;a+=1)RIPSAW.pen.controlPoint(this.map(this.control[a].temp),this.hoverIndex===a);return this},draw:function(){return RIPSAW.pen.configure("design outline"),this.placeMembers(),RIPSAW.pen.configure("primary control point"),this.placeControlPoints(),this},hasValidLegSpan:function(){return Math.abs(this.d)<this.l},getTotalHeight:function(){var a=0;if(!this.hasValidLegSpan())return a;for(i=0;i<this.n;i+=1)a+=this.getSegmentHeight(i);return a},normalize:function(){var a=1/this.getTotalHeight();return this.l*=a,this.d*=a,this.updateControl(),this},updateHoverState:function(){var a,b=this.control.length;for(this.hoverIndex=-1,a=0;b>a;a+=1)RIPSAW.mouse.hovers(this.map(this.control[a].perm))&&(this.hoverIndex=a)},mouseMove:function(){return RIPSAW.mouse.isDragging?-1!==this.hoverIndex&&(this.control[this.hoverIndex].setDrag(this.getObjectDrag()),this.updateGeometry(),this.updateControl()):this.updateHoverState(),this},mouseUp:function(){return-1!==this.hoverIndex&&this.control[this.hoverIndex].update(),this},mouseDown:function(){return this},toSVG:function(){var a,b=this.getMembers(100),c=b.length,d="";for(a=0;c>a;a+=1)d+="	"+b[a].toSVG()+"\n";return RIPSAW.textAssets.SVGHeader+"\n"+d+RIPSAW.textAssets.SVGFooter}},RIPSAW.inheritPrototype(RIPSAW.MasterPiece,RIPSAW.CurvingPantograph),RIPSAW.VoronoiIntersection=function(a,b){return this.points=a,this.waveFrontIndeces=b,this},RIPSAW.VoronoiIntersection.prototype={toString:function(){var a="";a+="{ "+this.points[0].toString(),this.points[1]&&(a+="; "+this.points[1].toString()),a+=" } - "+this.waveFrontIndeces[0]+", "+this.waveFrontIndeces[1]},matches:function(a){var b=this.waveFrontIndeces,c=a.waveFrontIndeces;return b[0]===c[0]&&b[1]===c[1]},isNearIdenticalTo:function(a){var b,c=this.points.length;if(a.points.length!==c)return!1;for(b=0;c>b;b+=1)if(!this.points[b].isNearEqualTo(a.points[b]))return!1;return this.matches(a)}},RIPSAW.voronoiWave=function(){var a,b,c,d,e,f,g={};return b=.001,c=.8,a=b,e=0,d=1.5,f=!1,g.get=function(){return a},g.set=function(b){return a=b,this},g.step=function(g){var h="undefined"==typeof g?!1:g;return a+=(c-b)*e*RIPSAW.refreshInterval/(1e3*d),b>a&&(e=-1),a>c&&(e=h?1:0,a=b,f=!0),this},g.reset=function(){return a=b,this},g.start=function(){return e=1,this},g.reachedEnd=function(){return f},g.restart=function(){return a=b,e=1,this},g.setMax=function(a){return c=a,this},g.setMin=function(a){return b=a,this},g.setPeriod=function(a){return d=a,this},g},RIPSAW.voronoiWaveFront=function(a){var b=[],c=4,d={},e=a;return d.add=function(a){return b.push(a),this},d.getList=function(){var a,c=b.length,d=[];for(a=0;c>a;a+=1)d.push(b[a].clone());return d},d.clear=function(){return b=[],this},d.build=function(a){var c,d,f,g,h,i,j=e.length;for(b=[],c=0;j>c;c+=1)i=e[c].temp,d=i.clone().add(new RIPSAW.Vector(+a,0)),f=i.clone().add(new RIPSAW.Vector(0,+a)),g=i.clone().add(new RIPSAW.Vector(-a,0)),h=i.clone().add(new RIPSAW.Vector(0,-a)),b.push(new RIPSAW.Line(d,f)),b.push(new RIPSAW.Line(f,g)),b.push(new RIPSAW.Line(g,h)),b.push(new RIPSAW.Line(h,d));return this},d.getIntersections=function(){var a,d,e,f,g,h,i=[],j=b.length;for(a=0;j>a;a+=1)for(e=b[a],d=a+1;j>d;d+=1)Math.floor(a/c)!==Math.floor(d/c)&&(f=b[d],g=e.intersectXY(f,.004),("inside"===g.type||"overlap"===g.type)&&(h=new RIPSAW.VoronoiIntersection(g.points,[a,d]),i.push(h)));return i},d.isControllingIntersection=function(a){var b,c,d,f,g=e.length;for(c=0,d=1e4,b=0;g>b;b+=1)f=e[b].temp,distance=a.getManhattanDistanceTo(f),RIPSAW.areNearEqual(distance,d,.0056)?c+=1:distance<d&&(d=distance,c=1);return c>=2},d.getSimpleIntersections=function(){var a,b,c,d=this.getIntersections(),e=d.length,f=[];for(a=0;e>a;a+=1)b=d[a],c=b.points,(this.isControllingIntersection(c[0])||c[1]&&this.isControllingIntersection(c[1]))&&f.push(b);return f},d},RIPSAW.Voronoi=function(){return RIPSAW.MasterPiece.call(this),this.nodes=[],this.links=[],this.wave=RIPSAW.voronoiWave(),this.waveFront=RIPSAW.voronoiWaveFront(this.control),this},RIPSAW.Voronoi.prototype={addControlPoint:function(a){return this.control.push(new RIPSAW.DragNode(a.x||0,a.y||0)),this},createRectangularGrid:function(a,b,c,d){var e,f;for(e=0;c>e;e+=1)for(f=0;d>f;f+=1)this.addControlPoint(new RIPSAW.Vector(e*a/(c-1),f*b/(d-1),0));return this},createIrregularGrid:function(a){var b;for(b=0;a>b;b+=1)this.addControlPoint({x:Math.random()-.5,y:Math.random()-.5});return this},getBoundingRectangle:function(){var a,b,c=-5e3,d=-5e3,e=5e3,f=5e3,g=this.control.length;for(a=0;g>a;a+=1)b=this.control[a].temp,c=Math.max(c,b.x),e=Math.min(e,b.x),d=Math.max(d,b.y),f=Math.min(f,b.y);return{min:new RIPSAW.Vector(e,f),max:new RIPSAW.Vector(c,d)}},getCentroid:function(){var a=this.getBoundingRectangle();return new RIPSAW.Vector((a.max.x+a.min.x)/2,(a.max.y+a.min.y)/2)},getMaxDim:function(){var a=this.getBoundingRectangle();return Math.max(a.max.x-a.min.x,a.max.y-a.min.y)},moveGeometry:function(a){var b,c,d=this.control.length;for(b=0;d>b;b+=1)c=this.control[b],c.temp.add(a),c.update();return this},scaleGeometry:function(a){var b,c,d=this.control.length,e=a||1;for(b=0;d>b;b+=1)c=this.control[b],c.temp.scale(e),c.update();return this},normalize:function(a){var b,c;return a=a||1,b=this.getCentroid(),c=1/this.getMaxDim()*a,this.moveGeometry(b.scale(-1)).scaleGeometry(c),this},step:function(){var a,b,c,d,e,f,g,h,i=!1;for(this.wave.step(),this.waveFront.build(this.wave.get()),this.nodes=this.waveFront.getSimpleIntersections(),a=0,b=this.nodes.length;b>a;a+=1){for(e=this.nodes[a],g=e.waveFrontIndeces,i=!1,c=0,d=this.links.length;d>c;c+=1)f=this.links[c],h=f.waveFrontIndeces,g[0]===h[0]&&g[1]===h[1]&&(f.isOverlapLink||(f.p2=e.points[0]),i=!0);i||(1===e.points.length?this.links.push({p1:e.points[0],isOverlapLink:!1,waveFrontIndeces:e.waveFrontIndeces}):2===e.points.length&&this.links.push({p1:e.points[0],p2:e.points[1],isOverlapLink:!0,waveFrontIndeces:e.waveFrontIndeces}))}return this},placeWaveFront:function(){var a,b,c=this.waveFront.getList(),d=c.length;for(a=0;d>a;a+=1)b=c[a],RIPSAW.pen.line(this.map(b.p1),this.map(b.p2));return this},placeLinks:function(){var a,b,c=this.links.length;for(b=0;c>b;b+=1)a=this.links[b],a.p2&&(RIPSAW.pen.line(this.map(a.p1),this.map(a.p2)),RIPSAW.pen.controlPoint(this.map(a.p1)),RIPSAW.pen.controlPoint(this.map(a.p2)));return this},placeNodes:function(){var a,b=this.nodes.length;for(a=0,b=this.nodes.length;b>a;a+=1)RIPSAW.pen.controlPoint(this.map(this.nodes[a].points[0]));return this},draw:function(a){var b,c;for(this.step(),RIPSAW.pen.configure("primary control point"),b=0,c=this.control.length;c>b;b+=1)RIPSAW.pen.controlPoint(this.map(this.control[b].temp),this.hoverIndex===b);return RIPSAW.pen.configure("design thin"),this.placeWaveFront(),RIPSAW.pen.configure("design iso"),this.placeLinks(),RIPSAW.pen.configure("point"),this.placeNodes(),this},mouseUp:function(){return-1!==this.hoverIndex&&this.control[this.hoverIndex].update(),this},mouseDown:function(){return this},updateHoverState:function(){var a,b=this.control.length;for(this.hoverIndex=-1,a=0;b>a;a+=1)RIPSAW.mouse.hovers(this.map(this.control[a].perm))&&(this.hoverIndex=a);return this},mouseMove:function(){RIPSAW.mouse.getNormalizedDrag();return RIPSAW.mouse.isDragging?-1!==this.hoverIndex&&this.control[this.hoverIndex].setDrag(this.getObjectDrag()):this.updateHoverState(),this},mouseDownRight:function(){return console.log(this.toRhinoPythonScript()),this.links=[],this.wave.reset().start(),this},toSVGPath:function(a){var b,c,d="",e=this.links.length,f=a||100;for(c=0;e>c;c+=1)b=this.links[c],b.p2&&(d+=new RIPSAW.Line(b.p1.clone().scale(f),b.p2.clone().scale(f)).toSVG()+"\n");return d},toSVG:function(){return RIPSAW.textAssets.SVGHeader+this.toSVGPath()+RIPSAW.textAssets.SVGFooter},toRhinoPythonScript:function(a){var b,c,d,e="",f=a||100;for(e=RIPSAW.textAssets.rhinoPythonScriptHeader,c=0,d=this.control.length;d>c;c+=1)e+="	rs.AddPoint("+this.control[c].temp.clone().scale(f).toRhinoPythonScript()+")\n";for(c=0,d=this.links.length;d>c;c+=1)b=this.links[c],b.p2&&(e+="	"+new RIPSAW.Line(b.p1.clone().scale(f),b.p2.clone().scale(f)).toRhinoPythonScript()+"\n");return e+=RIPSAW.textAssets.rhinoPythonScriptFooter}},RIPSAW.inheritPrototype(RIPSAW.MasterPiece,RIPSAW.Voronoi);
//# sourceMappingURL=ripsaw.min.js.map