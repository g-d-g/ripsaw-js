var RIPSAW={mode:"mode3",isModified:!1,time0:(new Date).getTime(),time:0,refreshInterval:5,anim:{speed:2e3,delay:500},containerID:"ripsaw-app",fonts:"Monaco",tolerance:.02,delta:1e-7,delta2:.001,defaultRadius:5,wDisplay:{path:.005,navButton:.03,text:1/80},rDim:{l:150,w:0,d:3,depthScale:10},mesh:{n1:100,n2:30,nP:3},masterPiece:{},padding:0};RIPSAW.textAssets={shapeLibrary:{fork:"M812.146,568.452c-52.453,1.613-75.052-19.368-75.052-19.368s25.041-21.028,75.859-20.174c71.82,1.211,104.502-31.494,104.502-31.494s-36.717-34.678-106.52-33.871c-57.942,0.672-72.765-19.906-72.765-19.906s11.267-17.453,58.642-16.405c73.03,1.612,132.834-23.802,132.834-23.802c-267.869-111.5-264.88,45.689-424.959,35.904C290.183,426.229,63.01,307.15,70.535,484.526c6.455,152.186,145.255,64.558,422.294,69.399c189.035,3.305,216.292,149.023,434.714,45.998C927.543,599.924,880.07,566.362,812.146,568.452z",person:"M75.303,533.052c6.047-65.575,80.289-100.945,124.724-54.667c49.041,51.07,127.95-12.528,71.852-141.562c-53.526-123.12,98.943-150.686,76.232-11.144C330.313,435.04,450.169,454.823,531.399,448.803c119.931-8.888,240.646-99.284,282.131-141.198c74.615-75.384,147.605,80.856,42.819,114.361c-102.57,32.796-177.442,45.126-174.202,107.489c3.158,60.764,63.259,100.824,165.825,102.922c139.445,2.85,65.561,197.484-31.098,111.666c-94.177-83.614-222.416-138.441-306.662-140.58C372.517,599.966,323.882,636.691,354.5,746.05c31.259,111.651-124.696,102.712-87.589,1.838c47.478-129.076,8.109-209.991-58.472-152.687C155.535,640.734,68.186,610.213,75.303,533.052z",moustache:"M745.947,405.463c106.682,88.078,192.916,26.735,192.916,26.735C754.697,759.384,501.959,567.383,501.959,567.383C272.733,769.18,61.138,463.543,61.138,463.543c56.816,43.103,128.065,50.273,186.069-7.729c58.006-58.005,162.409-123.742,254.752,27.065C560.734,350.4,659.676,334.236,745.947,405.463z"},SVGHeader:['<svg version="1.1" id="trace" ','xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" ','viewBox="0 0 200 100" ','style="enable-background:new 0 0 200 100;" xml:space="preserve" >'].join("\n"),SVGFooter:"</svg>",rhinoPythonScriptHeader:['\n"""\n\nScript file generated by Yourk, www.RIPSAW.com/Yourk/experiment_1',"\nInstructions:","	- copy this code and paste it into a *.py file","	- open Rhino (rhino3d.com). The software is currently in development for Mac and free to use. Commercial license is needed for Windows. [stay tuned for a SketchUp implementation]","	- type RunPythonScript in the Rhino command line, and select your file.","	- in the current development phase, the geometry generated by this script needs to be trimmed manually to obtain the final 3d model. Stay tuned for full automation.","	- Rhino exports seamlessly into .stl format, which is directly imported into MakerWare, the software used to send geometries to MakerBot 3d printers. Check out the image gallery under RIPSAW.com/design/Yourk/ for images of the very first Yourk 3d printing process.",'\n"""',"\nimport rhinoscriptsyntax as rs\n\nimport math\n\ndef Main():\n\n"].join("\n"),rhinoPythonScriptFooter:"Main()"},RIPSAW.touchHandler=function(t){var e=t.changedTouches[0],n=document.createEvent("MouseEvent");return n.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[t.type],!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(n),this},RIPSAW.addTouchHandlers=function(){return document.addEventListener("touchstart",this.touchHandler,!0),document.addEventListener("touchmove",this.touchHandler,!0),document.addEventListener("touchend",this.touchHandler,!0),document.addEventListener("touchcancel",this.touchHandler,!0),this},RIPSAW.createCanvas=function(){return this.canvas=document.createElement("canvas"),this.canvas.id="ripsaw-canvas",this.ctx=this.canvas.getContext("2d"),this.ctx.lineCap="round",this.canvas.style.margin="auto",this.container.appendChild(this.canvas),this},RIPSAW.addDefaultEventListeners=function(){return"undefined"==typeof this.mouseDown&&(RIPSAW.mouseDown=function(t){t.preventDefault(),!t.which&&t.button&&(1&t.button?t.which=1:4&t.button?t.which=2:2&t.button&&(t.which=3)),1===t.which?(RIPSAW.mouse.update(t,"down"),RIPSAW.masterPiece.mouseDown()):3===t.which&&RIPSAW.masterPiece.mouseDownRight()}),"undefined"==typeof this.mouseMove&&(RIPSAW.mouseMove=function(t){RIPSAW.mouse.update(t,"move"),RIPSAW.masterPiece.mouseMove()}),"undefined"==typeof this.mouseUp&&(RIPSAW.mouseUp=function(t){RIPSAW.mouse.update(t,"up"),RIPSAW.masterPiece.mouseUp()}),"undefined"==typeof this.keyPressed&&(RIPSAW.keyPressed=function(t){RIPSAW.masterPiece.keyPressed()}),this.canvas.addEventListener("mousedown",this.mouseDown),this.canvas.addEventListener("mousemove",this.mouseMove),this.canvas.addEventListener("mouseup",this.mouseUp),window.addEventListener("keypressed",this.keyPressed),this},RIPSAW.resize=function(){var t,e;RIPSAW.container.style;return t=e=2*RIPSAW.padding,RIPSAW.W=RIPSAW.container.clientWidth-t,RIPSAW.H=RIPSAW.container.clientHeight-e,(RIPSAW.W<0||RIPSAW.H<0)&&(RIPSAW.W=0,RIPSAW.H=0,setTimeout(RIPSAW.resize,200)),RIPSAW.minWH=Math.min(RIPSAW.W,RIPSAW.H),RIPSAW.maxWH=Math.max(RIPSAW.W,RIPSAW.H),RIPSAW.canvas.width=RIPSAW.W,RIPSAW.canvas.height=RIPSAW.H,this},RIPSAW.init=function(){return this.container=document.getElementById(this.containerID),this.createCanvas(),this.isModified=!1,this.addDefaultEventListeners(),this.addTouchHandlers(),window.addEventListener("resize",RIPSAW.resize,!1),this.resize(),this},RIPSAW.prepDraw=function(){return RIPSAW.ctx.fillStyle=RIPSAW.colors.get(0,1),RIPSAW.pen.solidRect(0,0,RIPSAW.W,RIPSAW.H),RIPSAW.ctx.textAlign="center",RIPSAW.ctx.textBaseline="middle",RIPSAW.time=(new Date).getTime(),this},RIPSAW.launch=function(){return RIPSAW.resize(),RIPSAW.draw=RIPSAW.draw||function(){RIPSAW.prepDraw(),RIPSAW.masterPiece.draw()},setInterval(RIPSAW.draw,RIPSAW.refreshInterval),this},RIPSAW.tearDown=function(){return this.canvas.parentNode.removeChild(this.canvas),this},RIPSAW.events={on:function(t,e){this._events=this._events||{};var n=this._events[t]||(this._events[t]=[]);n.push({callback:e})},off:function(t,e){var n,i,o=this._events[t],s=-1;for(n=0,i=o.length,n=0;i>n;n+=1)o[n].callback===e&&(s=n);-1!==s&&o.splice(s,1)},trigger:function(t){var e,n=this._events[t]||[],i=n.length;for(e=0;i>e;e+=1)n[e].callback()}},RIPSAW.observer=function(){var t=[],e={};return e.indexOf=function(e){return t.indexOf(e)},e.getSubscriber=function(e){return t[e]},e.subscribe=function(n){return t.push(n),e},e.unsubscribe=function(n){var i=this.indexOf(n);return"undefined"!=typeof i&&-1!==i&&t.splice(i,1),e},e.fire=function(e){var n,i,o=t.length;for(n=0;o>n;n+=1)i=t[n],"undefined"!=typeof i&&"undefined"!=typeof i[e]&&i[e]()},e},RIPSAW.inherit=function(t){function e(){}return e.prototype=t,new e},RIPSAW.inheritPrototype=function(t,e){var n;"undefined"==typeof e&&(e=function(){});for(n in t.prototype)e.prototype[n]=t.prototype[n];return e},RIPSAW.bind=function(t,e){return function(){return t.apply(e,Array.prototype.slice.call(arguments))}},RIPSAW.extend=function(t,e){var n;t=t||{};for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},RIPSAW.areNearEqual=function(t,e,n){var i="undefined"==typeof n?RIPSAW.delta:n;return Math.abs(t-e)<i},RIPSAW.map=function(t){return new RIPSAW.Vector(t.x*RIPSAW.W,t.y*RIPSAW.H,0)},RIPSAW.sineAnimate=function(t,e,n,i,o){var s;return s=RIPSAW.time-RIPSAW.time0<i?0:RIPSAW.time-RIPSAW.time0>o?o-i:RIPSAW.time-RIPSAW.time0-i,Math.sin(s/e*2*Math.PI+n)},RIPSAW.Matrix=function(t,e){this.n=t||2,this.m=e||2,this.table=[];for(var n=0;n<this.n;n+=1){this.table.push([]);for(var i=0;i<this.m;i+=1)this.table[n].push(0)}return this},RIPSAW.Matrix.prototype={toString:function(){var t,e,n="Matrix "+this.n+" x "+this.m+"\n";for(t=0;t<this.n;t+=1){for(n+="|",e=0;e<this.m;e+=1)n+=" "+this.table[t][e]+" ";n+="|\n"}return console.log(new RIPSAW.Matrix(2,2).populate(1,0,0,1).inverse()),n},populate:function(){var t,e=arguments.length;for(t=0,e=arguments.length;e>t;t+=1)this.table[Math.floor(t/this.m)][t%this.m]=arguments[t];return this},determinant:function(){var t=this.table;return 2===this.n&&2===this.m?t[0][0]*t[1][1]-t[0][1]*t[1][0]:void 0},inverse:function(){var t=this.determinant(),e=new RIPSAW.Matrix(this.n,this.m);return 0===t?void 0:(2===this.n&&2===this.m&&(e.table[0][0]=+this.table[1][1]/t,e.table[1][0]=-this.table[1][0]/t,e.table[0][1]=-this.table[0][1]/t,e.table[1][1]=+this.table[0][0]/t),e)},multiply:function(t){var e,n,i,o,s=this,r=new RIPSAW.Matrix(s.n,t.m);for(e=0;e<s.n;e+=1)for(n=0;n<t.m;n+=1){for(o=0,i=0;i<s.m;i+=1)o+=s.table[e][i]*t.table[i][n];r.table[e][n]=o}for(this.n=r.n,this.m=r.m,this.table=[],e=0;e<this.n;e+=1)for(this.table.push([]),n=0;n<this.m;n+=1)this.table[e].push(r.table[e][n]);return this},clone:function(){var t,e,n=new RIPSAW.Matrix(this.n,this.m);for(t=0;t<this.n;t+=1)for(e=0;e<this.m;e+=1)n.table[t][e]=this.table[t][e];return n}},RIPSAW.Vector=function(t,e,n){return this.x=t||0,this.y=e||0,this.z=n||0,this},RIPSAW.Vector.prototype={constructor:RIPSAW.Vector,log:function(t){var e=t||2;return"x: "+this.x.toFixed(e)+" | y: "+this.y.toFixed(e)+" | z: "+this.z.toFixed(e)},toString:function(t){var e=t||2;return"["+this.x.toFixed(e)+","+this.y.toFixed(e)+","+this.z.toFixed(e)+"]"},match:function(t){var e=Math.abs(this.x-t.x),n=Math.abs(this.y-t.y),i=Math.abs(this.z-t.z);return e<RIPSAW.delta&&n<RIPSAW.delta&&i<RIPSAW.delta&&(this.x=t.x,this.y=t.y,this.z=t.z),this},isNearEqualTo:function(t){return Math.abs(this.x-t.x)<RIPSAW.delta&&Math.abs(this.y-t.y)<RIPSAW.delta&&Math.abs(this.z-t.z)<RIPSAW.delta},getDistanceTo:function(t){return Math.pow(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)+Math.pow(this.z-t.z,2),.5)},getManhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},normalize:function(t){var e=this.getDistanceTo(new RIPSAW.Vector(0,0,0)),n=0!==e?(t||1)/e:1;return this.x*=n,this.y*=n,this.z*=n,this},add:function(t){return t instanceof RIPSAW.Vector&&(this.x+=t.x||0,this.y+=t.y||0,this.z+=t.z||0),this},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},scale:function(t){return this.x*=t,this.y*=t,this.z*=t,this},dotProduct:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},product:function(t){return this.getProduct(t)},getProduct:function(t){return new RIPSAW.Vector(this.x*t.x,this.y*t.y,this.z*t.z)},crossMultiply:function(t){var e=+this.y*t.z-this.z*t.y,n=-this.x*t.z+this.z*t.x,i=+this.x*t.y-this.y*t.x;return this.x=e,this.y=n,this.z=i,this},getCrossProduct:function(t){return this.clone().crossMultiply(t)},clone:function(t){return new RIPSAW.Vector(this.x,this.y,this.z).add(t)},getLinearCombination:function(t,e){for(var n=Math.min(t.length,e.length),i=0,o=0,s=0,r=0;n>r;r+=1)i+=t[r].x*e[r],o+=t[r].y*e[r],s+=t[r].z*e[r];return new RIPSAW.Vector(i,o,s)},swapYZ:function(){var t=this.y;return this.y=this.z,this.z=t,this},project:function(t){var e=t.project(this);return this.x=e.x,this.y=e.y,this.z=e.z,this},toRhinoPythonScript:function(){return"["+this.x.toFixed(2)+","+this.y.toFixed(2)+","+this.z.toFixed(2)+"]"},toRhinoPythonScriptArray:function(t){var e="	"+t+".append("+this.toRhinoPythonScript()+")\n";return e}},RIPSAW.DragNode=function(t,e,n,i,o,s){return t instanceof RIPSAW.Vector?this.temp=new RIPSAW.Vector(t.x,t.y,t.z):this.temp=new RIPSAW.Vector(t,e,n),this.perm=this.temp.clone(),this.constraints=new RIPSAW.Vector(i||1,o||1,s||1),this},RIPSAW.DragNode.prototype={constructor:RIPSAW.DragNode,update:function(){return this.perm=this.temp.clone(),this},revert:function(){return this.temp=this.perm.clone(),this},setDrag:function(t){return this.temp=this.perm.clone(t.getProduct(this.constraints)),this},getDrag:function(){return this.temp.clone().subtract(this.perm)},clone:function(){return new RIPSAW.DragNode(this.perm.x,this.perm.y,this.perm.z,this.constraints.x,this.constraints.y,this.constraints.z)}},RIPSAW.PointCloud=function(t){this._list=[];var e,n,i,o;if(arguments[0]instanceof Array)for(n=arguments[0],o=0,i=n.length;i>o;o+=1)e=n[o],this._list.push(new RIPSAW.Vector(e.x||0,e.y||0,e.z||0));return this},RIPSAW.PointCloud.prototype={addPoint:function(t){return this._list.push(t),this},getPoint:function(t){return this._list[t]},getPointCount:function(){return this._list.length},sortX:function(){return this._list.sort(function(t,e){return t.x>e.x?1:-1}),this},sortY:function(){return this._list.sort(function(t,e){return t.y>e.y?1:-1}),this},sortZ:function(){return this._list.sort(function(t,e){return t.z>e.z?1:-1}),this},getBoundingBox:function(){var t,e,n=-5e3,i=5e3,o=-5e3,s=5e3,r=-5e3,h=5e3,a=this._list.length;for(t=0;a>t;t+=1)e=this.getPoint(t),e.x>n&&(n=e.x),e.y>o&&(o=e.y),e.z>r&&(r=e.z),e.x<i&&(i=e.x),e.y<s&&(s=e.y),e.z<h&&(h=e.z);return{min:new RIPSAW.Vector(i,s,h),max:new RIPSAW.Vector(n,o,r)}},interpolateX:function(t){var e,n,i,o=this._list.length,s=[];for(e=0;o-1>e;e+=1)n=this._list[e],i=this._list[e+1],(n.x===t||i.x===t||n.x<t&&i.x>t||n.x>t&&i.x<t)&&s.push(new RIPSAW.Line(n,i).interpolateX(t));return s},getLength:function(){var t,e=this._list.length,n=0;for(t=0;e-1>t;t+=1)n+=this._list[t].getDistanceTo(this._list[t+1]);return n},getClosedLength:function(){return this.getLength()+this._list[this._list.length-1].getDistanceTo(this._list[0])},draw:function(t){var e,n=this.getPointCount(),i=t||function(t){return t};for(RIPSAW.pen.start(),RIPSAW.pen.moveTo(i(this.getPoint(0))),e=1;n>e;e+=1)RIPSAW.pen.lineTo(i(this.getPoint(e)));return RIPSAW.pen.end(),this},toSVG:function(){var t,e,n=this.getPointCount(),i='<polyline fill="none" stroke="black" stroke-linecap="round" stroke-linejoin="round" points = "';for(t=0;n>t;t+=1)e=this.getPoint(t),i+=e.x.toFixed(6)+","+e.y.toFixed(6)+" ";return i+='" />'}},RIPSAW.Line=function(t,e){return this.p1=t.clone(),this.p2=e.clone(),this},RIPSAW.Line.prototype={pointAt:function(t){var e=this.p1.x*(1-t)+this.p2.x*t,n=this.p1.y*(1-t)+this.p2.y*t,i=this.p1.z*(1-t)+this.p2.z*t;return new RIPSAW.Vector(e,n,i)},hasInBoundingRectangleXY:function(t){return t.x>=Math.min(this.p1.x,this.p2.x)&&t.x<=Math.max(this.p1.x,this.p2.x)&&t.y>=Math.min(this.p1.y,this.p2.y)&&t.y<=Math.max(this.p1.y,this.p2.y)},draw:function(){var t="undefined"!=typeof arguments[0]?arguments[0]:function(t){return t};return RIPSAW.line(t(this.p1),t(this.p2)),this},reverse:function(){var t=this.p1;return this.p1=this.p2,this.p2=t,this},getEquationXY:function(){var t,e,n;return this.p1.x===this.p2.x?(t=1,e=0,n=-this.p1.x):(t=(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x),e=-1,n=this.p2.y-t*this.p2.x),{a:t,b:e,c:n}},getMidPerpXY:function(){var t=this.p1.clone().subtract(this.p2),e=this.p1.clone().scale(.5).add(this.p2.clone().scale(.5));return t.crossMultiply(new RIPSAW.Vector(0,0,1)).normalize(),new RIPSAW.Line(e,e.clone().add(t))},scale:function(t){var e=this.p2.clone().subtract(this.p1).scale(t);return this.p2=this.p1.clone().add(e),this},getDistanceFromXY:function(t){var e=this.getEquationXY(),n=Math.pow(Math.pow(e.a,2)+Math.pow(e.b,2)+Math.pow(e.c,2),.5);return Math.abs(e.a*t.x+e.b*t.y+e.c)/n},interpolateX:function(t){var e,n;return RIPSAW.areNearEqual(this.p1.x,this.p2.x)?this.p1.clone():(e=(t-this.p1.x)/(this.p2.x-this.p1.x),n=this.p1.clone().scale(1-e),n.add(this.p2.clone().scale(e)),n)},intersectXY:function(t,e){var n,i,o,s,r,h,a=this,c="undefined"==typeof e?RIPSAW.delta2:e;return n=new RIPSAW.Matrix(2,2).populate(+(a.p2.x-a.p1.x),-(t.p2.x-t.p1.x),+(a.p2.y-a.p1.y),-(t.p2.y-t.p1.y)),Math.abs(n.determinant())<RIPSAW.delta?this.getDistanceFromXY(t.p1)<c?a.hasInBoundingRectangleXY(t.p1)||a.hasInBoundingRectangleXY(t.p2)?(h=new RIPSAW.PointCloud([this.p1.clone(),this.p2.clone(),t.p1.clone(),t.p2.clone()]).sortX().sortY(),{points:[h.getPoint(1).clone(),h.getPoint(2).clone()],type:"overlap"}):{points:[],type:"outerlap"}:{points:[],type:"parallel"}:(i=new RIPSAW.Matrix(2,1).populate(t.p1.x-a.p1.x,t.p1.y-a.p1.y),o=n.clone().inverse().multiply(i),s=o.table[0][0],r=o.table[1][0],{points:[a.pointAt(s)],type:s>=0&&1>=s&&r>=0&&1>=r?"inside":"outside",s1:s,s2:r})},getAngleXY:function(){var t,e=this.p1,n=this.p2;return Math.abs(e.x-n.x)<1e-5&&n.y>e.y?Math.PI/2:Math.abs(e.x-n.x)<1e-5&&n.y<e.y?3*Math.PI/2:(t=Math.atan((n.y-e.y)/(n.x-e.x)),e.x<n.x?0>t?t+2*Math.PI:t:t+Math.PI)},toSVG:function(){var t='<line fill="none" stroke="black" stroke-linecap="round" stroke-linejoin="round" ';return t+='x1 = "'+this.p1.x.toFixed(6)+'" ',t+='y1 = "'+this.p1.y.toFixed(6)+'" ',t+='x2 = "'+this.p2.x.toFixed(6)+'" ',t+='y2 = "'+this.p2.y.toFixed(6)+'" ',t+="/>"},toRhinoPythonScript:function(){return"rs.AddLine("+this.p1.toRhinoPythonScript()+", "+this.p2.toRhinoPythonScript()+")"},clone:function(){return new RIPSAW.Line(this.p1.clone(),this.p2.clone())}},RIPSAW.Camera=function(t,e,n,i){return this.r=this.rT="undefined"!=typeof t?t:1,this.theta=this.thetaT="undefined"!=typeof e?e:Math.PI/3,this.phi=this.phiT="undefined"!=typeof n?n:-Math.PI/4,this.f="undefined"!=typeof i?i:.6,this.eye=new RIPSAW.Vector,this.v1=new RIPSAW.Vector(1,0,0),this.v2=new RIPSAW.Vector(0,1,0),this.v3=new RIPSAW.Vector(0,0,1),this.buildEye(),this},RIPSAW.Camera.prototype={buildEye:function(){return this.eye=new RIPSAW.Vector(this.rT*Math.cos(this.thetaT)*Math.cos(this.phiT),this.rT*Math.sin(this.thetaT)*Math.cos(this.phiT),this.rT*Math.sin(this.phiT)).normalize(),this.v1=this.eye.clone().scale(-1),this.v2=this.v1.clone().crossMultiply(new RIPSAW.Vector(0,0,1)).normalize(),this.v3=this.v2.clone().crossMultiply(this.v1),this},update:function(){return this.r=this.rT,this.theta=this.thetaT,this.phi=this.phiT,this},revert:function(){return this.rT=this.r,this.thetaT=this.theta,this.phiT=this.phi,this.buildEye(),this},project:function(t){var e,n,i,o=this.eye.clone().subtract(t);return e=o.dotProduct(this.v2),n=o.dotProduct(this.v3),i=o.dotProduct(this.v1),new RIPSAW.Vector(e*this.f/i,n*this.f/i,0)},constrainViewHeight:function(){var t=80*Math.PI/180;return this.phiT<-t&&(this.phiT=-t),this.phiT>+t&&(this.phiT=+t),this},setDrag:function(){var t=RIPSAW.mouse.getDrag();return this.thetaT=this.theta-t.x/RIPSAW.minWH*2,this.phiT=this.phi-t.y/RIPSAW.minWH*2,this},mouseDrag:function(){return this.setDrag().constrainViewHeight().buildEye(),this},mouseMove:function(){return"3dpreview"===RIPSAW.mode&&RIPSAW.mouse.isDragging&&this.setDrag().constrainViewHeight().buildEye(),this},mouseUp:function(){return this.update(),this},mouseDown:function(){return this}},RIPSAW.colors={schemes:{purple:[[61,56,79],[247,141,52],[203,168,114],[61,103,196],[95,52,247],[61,103,196],[95,90,113],[255,255,255]],bw:[[255,255,255],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]},activeScheme:"purple",get:function(t,e){var n=this.schemes[this.activeScheme][t];return"rgba("+n[0]+","+n[1]+","+n[2]+","+e+")"},getBetween:function(t,e,n,i){var o=this.schemes[this.activeScheme],s=[o[t][0]*n+o[e][0]*(1-n),o[t][1]*n+o[e][1]*(1-n),o[t][2]*n+o[e][2]*(1-n)];return"rgba("+Math.round(s[0])+","+Math.round(s[1])+","+Math.round(s[2])+","+i+")"}},RIPSAW.pen={displayDimensions:{nav:{outline:.002,buttonSize:.03}},styles:{"design outline":{dim:.005,strokeColor:7,fillColor:1},"design iso":{dim:.002,strokeColor:7,fillColor:1},"design thin":{dim:.001,strokeColor:7,fillColor:1},"nav bounding box":{dim:.002,strokeColor:6},"design handle":{dim:1/300,strokeColor:7,fillColor:1},"control point":{dim:.01,strokeColor:1,fillColor:5},"primary control point":{dim:.01,strokeColor:1,fillColor:4},"secondary control point":{dim:.01,strokeColor:1,fillColor:5},point:{dim:1/150,strokeColor:1,fillColor:2}},configure:function(t){var e=RIPSAW.pen.styles[t];RIPSAW.pen.stroke(e.dim||.01),RIPSAW.pen.radius(e.dim),RIPSAW.pen.color.stroke(e.strokeColor||1),RIPSAW.pen.color.fill(e.fillColor||1)},solidRect:function(t,e,n,i){RIPSAW.ctx.beginPath(),RIPSAW.ctx.rect(t,e,n,i),RIPSAW.ctx.closePath(),RIPSAW.ctx.fill()},write:function(t,e,n,i,o,s){RIPSAW.ctx.fillStyle=RIPSAW.colors.get(o,s),RIPSAW.ctx.font=""+RIPSAW.W*RIPSAW.wDisplay.text*i+"px "+RIPSAW.fonts,RIPSAW.ctx.fillText(t,RIPSAW.W*e,RIPSAW.H*n)},start:function(){RIPSAW.ctx.beginPath()},end:function(){RIPSAW.ctx.stroke()},moveTo:function(t){RIPSAW.ctx.moveTo(t.x,t.y)},lineTo:function(t){RIPSAW.ctx.lineTo(t.x,t.y)},line:function(t,e){this.start(),this.moveTo(t),this.lineTo(e),this.end()},arc:function(t,e,n){e>0&&(this.start(),RIPSAW.ctx.arc(t.x,t.y,e,n.theta1,n.theta2),this.end())},splineTo:function(t,e,n){RIPSAW.ctx.bezierCurveTo(t.x,t.y,e.x,e.y,n.x,n.y)},solidCircle:function(t,e){e="undefined"==typeof e?RIPSAW.defaultRadius:e*RIPSAW.minWH,RIPSAW.ctx.beginPath(),RIPSAW.ctx.arc(t.x,t.y,e,0,2*Math.PI,!0),RIPSAW.ctx.fill()},controlPoint:function(t,e,n){var i=RIPSAW.defaultRadius;i=e?2*i:i,RIPSAW.pen.solidCircle(t,i)},stroke:function(t){RIPSAW.ctx.lineWidth=t*RIPSAW.minWH},radius:function(t){RIPSAW.defaultRadius=t},color:{stroke:function(t,e){RIPSAW.ctx.strokeStyle=RIPSAW.colors.get(t,e||1)},fill:function(t,e){RIPSAW.ctx.fillStyle=RIPSAW.colors.get(t,e||1)}},animateCircle:function(t,e,n,i,o,s,r){var h,a;RIPSAW.time-RIPSAW.time0>=s&&RIPSAW.time-RIPSAW.time0<=r&&(a=(r-RIPSAW.time+RIPSAW.time0)/(r-s),h=e*a+n*(1-a),RIPSAW.ctx.strokeStyle=RIPSAW.colors.getBetween(i,o,a,a),RIPSAW.ctx.lineWidth=RIPSAW.minWH/200,RIPSAW.pen.arc(RIPSAW.map(t),h*RIPSAW.minWH,{theta1:0,theta2:2*Math.PI}))},boundingBox:function(t,e,n){var i=t.x,o=t.y,s=e.x,r=e.y;RIPSAW.pen.line({x:i+n,y:o},{x:i+s-n,y:o}),RIPSAW.pen.line({x:i+s,y:o+n},{x:i+s,y:o+r-n}),RIPSAW.pen.line({x:i+s-n,y:o+r},{x:i+n,y:o+r}),RIPSAW.pen.line({x:i,y:o+r-n},{x:i,y:o+n}),RIPSAW.pen.arc({x:i+n,y:o+n},n,{theta1:1*Math.PI,theta2:1.5*Math.PI}),RIPSAW.pen.arc({x:i+s-n,y:o+n},n,{theta1:1.5*Math.PI,theta2:2*Math.PI}),RIPSAW.pen.arc({x:i+n,y:o+r-n},n,{theta1:Math.PI/2,theta2:1*Math.PI}),RIPSAW.pen.arc({x:i+s-n,y:o+r-n},n,{theta1:2*Math.PI,theta2:2.5*Math.PI})}},RIPSAW.mouse=function(){var t={},e=0,n=0,i=0,o=0;return t=RIPSAW.observer(),t.isDragging=!1,t.getPosition=function(t){var i=RIPSAW.canvas.getBoundingClientRect();e=t.clientX-i.left,n=t.clientY-i.top},t.getDrag=function(){return new RIPSAW.Vector(e-i,n-o,0)},t.getNormalizedDrag=function(){return this.getDrag().product(new RIPSAW.Vector(1/RIPSAW.W,1/RIPSAW.H))},t.distanceTo=function(t){return new RIPSAW.Vector(e,n).getDistanceTo(t)},t.hovers=function(t){return this.distanceTo(t)<RIPSAW.minWH*RIPSAW.tolerance},t.positionTo=function(t){return new RIPSAW.Vector(e-t.x,n-t.y)},t.update=function(t,s){this.getPosition(t),"down"===s?(this.isDragging=!0,i=e,o=n):"up"===s&&(this.isDragging=!1)},t.down=function(t){return this.update(t,"down"),this.obs.fire("mouseDown"),this},t.up=function(t){return this.update(t,"up"),this.obs.fire("mouseDown"),this},t.move=function(t){return this.update(t,"move"),this.obs.fire("mouseMove"),this},t}(),RIPSAW.stage=function(){var t={};return t=RIPSAW.observer(),t.no=0,t.update=function(){return this.fire("stageUpdate"),RIPSAW.time0=RIPSAW.time,this},t.change=function(t){return this.no=Math.round(10*(this.no+t))/10,this.update(),this},t.set=function(t){return this.no=Math.round(10*t)/10,this.update(),this},t}(),RIPSAW.tutorial={x:.5,dx:0,y:.75,dy:.05,text:[],place:function(){if("undefined"!=typeof text){var t,e=text.length;for(t=0;e>t;t+=1)RIPSAW.pen.write(this.text[t],this.x+t*this.dx,this.y+t*this.dy,1,2,1)}},stageUpdate:function(){this.text=this.stageManager[RIPSAW.stage.no]}},RIPSAW.MenuButton=function(t,e,n,i){this.name=n,this.isActive=!1,this.x=t,this.y=e,this.w=RIPSAW.wDisplay.navButton,this.h=RIPSAW.wDisplay.navButton,this.damping=.03,this.opacity=.4,this.targetOpacity={"true":1,"false":.4},this.animate=i||!1},RIPSAW.MenuButton.prototype={isHovered:function(){var t=RIPSAW.mouse.positionTo(RIPSAW.map(this));return Math.abs(t.x)<this.w*RIPSAW.maxWH/2&&Math.abs(t.y)<this.h*RIPSAW.W/2},setDisplayOpacity:function(){return this.opacity+=(this.targetOpacity[this.isActive]-this.opacity)*this.damping,RIPSAW.ctx&&(RIPSAW.ctx.globalAlpha=this.opacity),this},animateMarkingCircle:function(){return RIPSAW.ctx.globalAlpha=1,this.animate&&RIPSAW.pen.animateCircle(this,.05,.12,2,0,RIPSAW.anim.delay,RIPSAW.anim.delay+500),this},place:function(){return this.setDisplayOpacity(),RIPSAW.ctx.drawImage(RIPSAW.allButtons[this.name].image,RIPSAW.map(this).x-this.w*RIPSAW.maxWH/2,RIPSAW.map(this).y-this.h*RIPSAW.maxWH/2,this.w*RIPSAW.maxWH,this.h*RIPSAW.maxWH),this.animateMarkingCircle(),this}},RIPSAW.Navigation=function(t){this.buttons=[],this.buttonGroups=[],this.hoverIndex=-1,this.displayHelp=!0,this.helpX=.5,this.helpY=.5,this.defaultMode="mode2","undefined"!=typeof t&&this.build(t)},RIPSAW.Navigation.prototype={build:function(t){var e,n;if(this.displayHelp=t.displayHelp||!0,this.defaultMode=t.defaultMode||"mode2",this.helpX=t.xHelp||.5,this.helpY=t.yHelp||.5,this.buttons=[],this.buttonGroups=[],"undefined"!=typeof t){for(e=0,n=t.buttons.length;n>e;e+=1)this.buttons.push(new RIPSAW.MenuButton(t.buttons[e].x,t.buttons[e].y,t.buttons[e].name,t.buttons[e].animate));this.buttonGroups=t.buttonGroups||[]}},mouseDown:function(){-1!==this.hoverIndex&&"undefined"!=typeof this.hoverIndex&&RIPSAW.allButtons[this.buttons[this.hoverIndex].name].onClick()},mouseMove:function(){var t,e=this.buttons.length;for(this.hoverIndex=-1,t=0;e>t;t+=1)this.buttons[t].isHovered()?(this.hoverIndex=t,this.buttons[t].isActive=!0):this.buttons[t].isActive=!1,this.buttons[t].name===RIPSAW.mode&&(this.buttons[t].isActive=!0);return this},placeButtons:function(){var t,e=this.buttons.length;for(t=0;e>t;t+=1)this.buttons[t].place();return this},placeHelp:function(){return this.displayHelp&&-1!==this.hoverIndex&&"undefined"!=typeof this.buttons[this.hoverIndex]&&RIPSAW.pen.write(RIPSAW.allButtons[this.buttons[this.hoverIndex].name].helpText,this.helpX,this.helpY,1,2,(this.buttons[this.hoverIndex].opacity-.4)/.6),this},getButtonGroupBoundaries:function(t){var e,n,i,o=this.buttonGroups[t],s=o.length,r=-5e3,h=-5e3,a=5e3,c=5e3;for(e=0;s>e;e++)n=this.buttons[o[e]].x,i=this.buttons[o[e]].y,n>r&&(r=n),i>h&&(h=i),a>n&&(a=n),c>i&&(c=i);return{min:new RIPSAW.Vector(a,c),max:new RIPSAW.Vector(r,h)}},placeBoundingBoxes:function(){var t,e,n,i,o,s,r;for(t=0,e=this.buttonGroups.length;e>t;t+=1)r=this.getButtonGroupBoundaries(t),n=r.min,i=r.max.subtract(r.min),o=RIPSAW.wDisplay.navButton*RIPSAW.W*1.3,s=.025*RIPSAW.minWH,RIPSAW.pen.boundingBox(RIPSAW.map(n).subtract(new RIPSAW.Vector(o/2,o/2)),RIPSAW.map(i).add(new RIPSAW.Vector(o,o)),s);return this},draw:function(){this.placeButtons(),this.placeHelp(),RIPSAW.pen.configure("nav bounding box"),this.placeBoundingBoxes()},stageUpdate:function(){var t=this.stageManager[RIPSAW.stage.no];return"undefined"!=typeof t&&(this.build(t),RIPSAW.mode=this.defaultMode),this}},RIPSAW.nav=new RIPSAW.Navigation,RIPSAW.MasterPiece=function(t,e,n){this.name="object",this.centroid=new RIPSAW.DragNode(t||.5,e||.5),this.scale=n||1,this.allow=new RIPSAW.MasterPiecePermissions("11000"),this.stageManager={},this.control=[],this.hoverIndex=-1},RIPSAW.MasterPiece.prototype={map:function(t){return new RIPSAW.Vector(this.centroid.temp.x*RIPSAW.W+t.x*RIPSAW.minWH*this.scale,this.centroid.temp.y*RIPSAW.H+t.y*RIPSAW.minWH*this.scale,0)},updateState:function(t){return"undefined"!=typeof t&&(this.allow.setBinaryString(t.permissionsBinary||"0"),this.centroid=new RIPSAW.DragNode(t.x0||.5,t.y0||.5),this.scale=t.scale||1),this},getObjectDrag:function(){return RIPSAW.mouse.getDrag().getProduct(new RIPSAW.Vector(1/RIPSAW.minWH/this.scale,1/RIPSAW.minWH/this.scale))}},RIPSAW.MasterPiecePermissions=function(t){return this.permissionList=["draw","edit","pan","zoom","rotate"],this.setBinaryString(t||"11000"),this},RIPSAW.MasterPiecePermissions.prototype={getByIndex:function(t){return this[this.permissionList[t]]},setByIndex:function(t,e){return this[this.permissionList[t]]=e,this},setBinaryString:function(t){var e,n=this.permissionList.length;for(t="[object String]"===Object.prototype.toString.call(t)?t:"0",e=0;n>e;e+=1)this[this.permissionList[e]]="1"===t.charAt(e);return this}},RIPSAW.BezierSVGPath=function(t){return this.raw=t,this},RIPSAW.BezierSVGPath.prototype={chop:function(){var t,e,n=this.raw,i=this.raw.length,o="",s="";for(e=[],t=0;i>t;t+=1)o=n.charAt(t),/[mMcCsSz]/.test(o)?(""!==s&&e.push(parseFloat(s)),e.push(o),s=""):","===o?(""!==s&&e.push(parseFloat(s)),s=""):"-"===o?(""!==s&&e.push(parseFloat(s)),s="-"):s+=o;return""!==s&&e.push(parseFloat(s)),e},vectorize:function(){var t,e,n,i,o=this.chop(),s=[],r=o.length,h=0;for(t=0;r>t;t+=1)i=o[t],/[mMcCsSz]/.test(i)?s.push(i):(h%2===0?e=i:(n=i,s.push(new RIPSAW.Vector(e,n))),h+=1);return s},absolutize:function(){var t,e=this.vectorize(),n=-1,i=e.length;for(t=0;i>t;t+=1)/[cs]/.test(e[t])?(n=t,e[t]=e[t].toUpperCase()):/[CS]/.test(e[t])?n=-1:-1!==n&&e[t].add(e[n-1]);return e},ridS:function(){var t,e=this.absolutize(),n=e.length,i=[];for(t=0;n>t;t+=1)"S"===e[t]?(i.push("C"),i.push(e[t-1].clone().scale(2).subtract(e[t-2]))):i.push(e[t]);return i},toBezierHandles:function(t){var e,n,i,o,s,r=this.ridS(),h=r.length,a=[];for("undefined"==typeof t&&(e=!0),n=2;h-1>n;n+=1)"C"===r[n]&&(i=2===n&&e?r[h-3]:2!==n||e?r[n-2]:r[n-1],o=r[n-1],s=r[n+1],a.push(new RIPSAW.BezierHandle(i,o,s)));return e||(i=r[h-2],o=r[h-1],s=r[h-1],a.push(new RIPSAW.BezierHandle(i,o,s))),a}},RIPSAW.BezierHandle=function(t,e,n){return this.p=[new RIPSAW.DragNode(t),new RIPSAW.DragNode(e),new RIPSAW.DragNode(n)],this.n=20,this.hoverType=-1,this.constraint=new RIPSAW.Vector(1,1,1),this},RIPSAW.BezierHandle.prototype={toString:function(){return output+="["+this.p[0].perm.x+", "+this.p[0].perm.y+"] - ",output+="["+this.p[1].perm.x+", "+this.p[1].perm.y+"] - ",output+="["+this.p[2].perm.x+", "+this.p[2].perm.y+"]",output+="\n",output},update:function(){return this.p[0].update(),this.p[1].update(),this.p[2].update(),this},clone:function(){return new RIPSAW.BezierHandle(new RIPSAW.DragNode(this.p[0].perm.x,this.p[0].perm.y,this.p[0].perm.z),new RIPSAW.DragNode(this.p[1].perm.x,this.p[1].perm.y,this.p[1].perm.z),new RIPSAW.DragNode(this.p[2].perm.x,this.p[2].perm.y,this.p[2].perm.z))},revert:function(){this.p[0].revert(),this.p[1].revert(),this.p[2].revert()},getHandleLengths:function(){return{temp:[this.p[0].temp.getDistanceTo(this.p[1].temp),this.p[2].temp.getDistanceTo(this.p[1].temp)],perm:[this.p[0].perm.getDistanceTo(this.p[1].perm),this.p[2].perm.getDistanceTo(this.p[1].perm)]}},setHandleLength:function(t,e){var n,i;return n=1-e/this.getHandleLengths().temp[t],Math.abs(n)<10&&(i=this.p[1].temp.clone(),i.subtract(this.p[2*t].temp),i.scale(n),this.p[2*t].temp.add(i)),this},preserveHandleLength:function(t){var e=this.getHandleLengths().perm[t];return this.setHandleLength(t,e),this},smooth:function(){var t,e,n=this.p[2].temp.x-this.p[0].temp.x,i=this.p[2].temp.y-this.p[0].temp.y;return t=0===n?100:i/n,e=this.p[2].temp.x>this.p[1].temp.x?1:-1,this.p[2].temp=this.p[1].temp.clone().add(new RIPSAW.Vector(+e,+e*t)),this.p[0].temp=this.p[1].temp.clone().add(new RIPSAW.Vector(-e,-e*t)),this.preserveHandleLength(0),this.preserveHandleLength(1),this.update(),this},drawControlHandles:function(t){t=t||function(t){return t},RIPSAW.pen.line(t(this.p[1].temp),t(this.p[0].temp)),RIPSAW.pen.line(t(this.p[1].temp),t(this.p[2].temp))},drawControlPoints:function(t){t=t||function(t){return t},RIPSAW.pen.controlPoint(t(this.p[0].temp),this.hoverType===i)},setDrag:function(t){var e,n=this.getHandleLengths().temp,i=this.hoverType,o=t.clone().product(this.constraint);if(-1!==i)switch(i){case 1:this.p[1].setDrag(o),this.p[0].setDrag(o),this.p[2].setDrag(o);break;case 0:case 2:this.p[i].setDrag(t),/mode[2-3]/.test(RIPSAW.mode)&&(e=n[(2-i)/2]/n[i/2],Math.abs(e)<10&&(this.p[2-i].setDrag(t.product(new RIPSAW.Vector(-e,-e))),/mode2/.test(RIPSAW.mode)&&this.preserveHandleLength((2-i)/2)))}return this},toRhinoPythonScript:function(){}},RIPSAW.Bezier2D=function(t){return RIPSAW.MasterPiece.call(this),this.theta=0,this.isClosed=!0,"string"==typeof t?this.control=new RIPSAW.BezierSVGPath(t).toBezierHandles():this.control=t,this},RIPSAW.Bezier2D.prototype={toString:function(){var t,e=this.control.length,n="";
for(t=0;e>t;t+=1)n+=this.control[t].toString();return n},addControlPoint:function(t){this.control.push(t)},createDepthProfile:function(t,e){var n,i=e||3,o=t||.1;for(this.control=[],n=0;i>n;n+=1)this.control.push(new RIPSAW.BezierHandle(new RIPSAW.Vector((n-.3)/(i-1)-.5,o,0),new RIPSAW.Vector((n+0)/(i-1)-.5,o,0),new RIPSAW.Vector((n+.3)/(i-1)-.5,o,0)));return this.constrainEnds(new RIPSAW.Vector(0,1,1)),this.n=15,this.isClosed=!1,this},getBoundingRectangle:function(){var t,e,n=-5e3,i=-5e3,o=5e3,s=5e3,r=this.control.length;for(t=0;r>t;t+=1)e=this.control[t],n=Math.max(n,e.p[0].temp.x,e.p[1].temp.x,e.p[2].temp.x),o=Math.min(o,e.p[0].temp.x,e.p[1].temp.x,e.p[2].temp.x),i=Math.max(i,e.p[0].temp.y,e.p[1].temp.y,e.p[2].temp.y),s=Math.min(s,e.p[0].temp.y,e.p[1].temp.y,e.p[2].temp.y);return{min:new RIPSAW.Vector(o,s),max:new RIPSAW.Vector(n,i)}},getCentroid:function(){var t=this.getBoundingRectangle();return new RIPSAW.Vector((t.max.x+t.min.x)/2,(t.max.y+t.min.y)/2)},getMaxDim:function(){var t=this.getBoundingRectangle();return Math.max(t.max.x-t.min.x,t.max.y-t.min.y)},moveGeometry:function(t){var e,n,i=this.control.length;for(e=0;i>e;e+=1)n=this.control[e],n.p[0].temp.add(t),n.p[0].update(),n.p[1].temp.add(t),n.p[1].update(),n.p[2].temp.add(t),n.p[2].update();return this},scaleGeometry:function(t){var e,n,i=this.control.length,o=t||1;for(e=0;i>e;e+=1)n=this.control[e],n.p[0].temp.scale(o),n.p[0].update(),n.p[1].temp.scale(o),n.p[1].update(),n.p[2].temp.scale(o),n.p[2].update();return this},normalize:function(){var t,e;return t=this.getCentroid(),e=1/this.getMaxDim(),this.moveGeometry(t.scale(-1)).scaleGeometry(e),this},constrainEnds:function(t){t||new RIPSAW.Vector(1,1,1);return this.control[0].constraint=t,this.control[this.control.length-1].constraint=t,this},isClosed:function(){return 0===this.control.length?!1:this.control[0].p[1].perm.isNearEqualTo(this.control[this.control.length-1].p[1].perm)},setSubdivisions:function(t){var e,n,i,o=0,s=[];for(i=0,e=this.control.length;e>i;i+=1)n=this.getSegmentLength(i),s.push(n),n>o&&(o=n);for(i=0,e=this.control.length;e>i;i+=1)this.control[i].n=Math.floor(s[i]/o*t);return this},getSegmentLength:function(t,e){var n,i=0,o=e||10;for(n=0;o>n;n+=1)p1=this.getPoint(t,n/o),p2=this.getPoint(t,(n+1)/o),i+=p1.getDistanceTo(p2);return i},getPoint:function(t,e){var n,i,o,s,r=t===this.control.length-1?0:t+1;return n=this.control[t].p[1].temp,i=this.control[t].p[2].temp,o=this.control[r].p[0].temp,s=this.control[r].p[1].temp,(new RIPSAW.Vector).getLinearCombination([n,i,o,s],[Math.pow(1-e,3)*Math.pow(e,0),Math.pow(1-e,2)*Math.pow(e,1)*3,Math.pow(1-e,1)*Math.pow(e,2)*3,Math.pow(1-e,0)*Math.pow(e,3)])},getSubdivision:function(t){var e,n,i,o,s=new RIPSAW.PointCloud;for(e=this.isClosed?this.control.length:this.control.length-1,i=0;e>i;i+=1)for(n=t||this.control[i].n,o=0;n>o;o+=1)s.addPoint(this.getPoint(i,o/(n-1)));return s},placeSpline:function(){var t,e=this.control.length;RIPSAW.pen.displayDimensions;for(RIPSAW.pen.start(),RIPSAW.pen.moveTo(this.map(this.control[0].p[1].temp)),t=1;e>t;t+=1)RIPSAW.pen.splineTo(this.map(this.control[t-1].p[2].temp),this.map(this.control[t].p[0].temp),this.map(this.control[t].p[1].temp));return this.isClosed&&RIPSAW.pen.splineTo(this.map(this.control[e-1].p[2].temp),this.map(this.control[0].p[0].temp),this.map(this.control[0].p[1].temp)),RIPSAW.pen.end(),this},placeControlHandles:function(){var t,e,n=this.control.length;for(t=0;n>t;t++)e=this.control[t],RIPSAW.pen.line(this.map(e.p[1].temp),this.map(e.p[0].temp)),RIPSAW.pen.line(this.map(e.p[1].temp),this.map(e.p[2].temp))},placeControlPoints:function(){var t,e,n,i=this.control.length;for(t=0;i>t;t++)for(n=this.control[t],e=0;3>e;e+=1)RIPSAW.pen.configure(1===e?"primary control point":"secondary control point"),RIPSAW.pen.controlPoint(this.map(n.p[e].temp),n.hoverType===e)},draw:function(){return this.allow.draw&&(RIPSAW.pen.configure("design outline"),this.placeSpline(),RIPSAW.pen.configure("design handle"),this.placeControlHandles(),RIPSAW.pen.configure("control point"),this.placeControlPoints()),this},clone:function(){var t,e=new RIPSAW.BezierObject([],this.theta,this.p0.x,this.p0.y,this.scale);for(t=0,max=this.control.length;t<max;t+=1)e.control.push(this.control[t].clone());return e},updateHoverState:function(){var t,e,n=this.control.length;for(this.hoverIndex=-1,t=0;n>t;t+=1)for(e=this.control[t],e.hoverType=-1,j=0;j<=2;j+=1)RIPSAW.mouse.hovers(this.map(e.p[j].perm))&&(this.hoverIndex=t,e.hoverType=1!==e.hoverType?j:1);return this},mouseMove:function(){var t;return this.allow.edit&&(t=RIPSAW.mouse.getNormalizedDrag(),RIPSAW.mouse.isDragging?-1===this.hoverIndex&&this.allow.pan?this.centroid.setDrag(t):-1!==this.hoverIndex&&/mode[1-3]/.test(RIPSAW.mode)&&this.allow.edit&&(this.control[this.hoverIndex].setDrag(this.getObjectDrag()),RIPSAW.isModified=!0):this.updateHoverState()),this},mouseUp:function(){return-1!==this.hoverIndex?this.control[this.hoverIndex].update():this.centroid.update(),this},mouseDown:function(){return"smooth"===RIPSAW.mode&&-1!==this.hoverIndex&&this.control[this.hoverIndex].smooth(),this},toSVGPath:function(){var t,e,n,i,o=this.control.length,s=RIPSAW.rDim.l;for(e="M"+((this.control[0].p[1].perm.x+.5)*s).toFixed(2)+","+((this.control[0].p[1].perm.y+.5)*s).toFixed(2),t=0;o>t;t+=1)n=this.control[t],i=t===o-1?this.control[0]:this.control[t+1],e+="C"+((n.p[2].perm.x+.5)*s).toFixed(2)+","+((n.p[2].perm.y+.5)*s).toFixed(2)+","+((i.p[0].perm.x+.5)*s).toFixed(2)+","+((i.p[0].perm.y+.5)*s).toFixed(2)+","+((i.p[1].perm.x+.5)*s).toFixed(2)+","+((i.p[1].perm.y+.5)*s).toFixed(2);return e+="z"},toDB:function(){return this.toSVGPath()},fromDB:function(t){return this.control=new RIPSAW.BezierSVGPath(t).toBezierHandles(),this},toSVG:function(){var t="";return t=RIPSAW.textAssets.SVGHeader,t+='<path style="fill:none;stroke-width:4;stroke:#000000;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;" ',t+='d="'+this.toSVGPath()+'">',t+=RIPSAW.textAssets.SVGFooter},toRhinoPythonScript:function(t,e,n){var i,o,s,r,h="",a=RIPSAW.rDim.l,c=new RIPSAW.Vector(1.02,1,1/RIPSAW.rDim.depthScale),u=function(t){var e,n=t.length,i="";for(e=0;n>e;e+=1)i+="pts["+t[e]+"]",n-1>e&&(i+=",");return i};for(h+='\n	rs.AddLayer("'+t+'")\n',h+='	rs.CurrentLayer("'+t+'")\n',h+="\n	pts = []",h+="\n	"+t+"_crvs = []\n\n",o=0,s=this.control.length;s>o;o+=1)r=this.control[o],n?(h+=r.p[0].perm.clone().scale(a).toRhinoPythonScriptArray("pts"),h+=r.p[1].perm.clone().scale(a).toRhinoPythonScriptArray("pts"),h+=r.p[2].perm.clone().scale(a).toRhinoPythonScriptArray("pts")):(h+=r.p[0].perm.clone().swapYZ().scale(a).product(c).toRhinoPythonScriptArray("pts"),h+=r.p[1].perm.clone().swapYZ().scale(a).product(c).toRhinoPythonScriptArray("pts"),h+=r.p[2].perm.clone().swapYZ().scale(a).product(c).toRhinoPythonScriptArray("pts"));for(o=0,s=this.control.length;s>o;o+=1)i="",o<this.control.length-1?(i=u([3*o+1,3*o+2,3*o+3,3*o+4]),h+="\n	"+t+"_crvs.append(rs.AddCurve(["+i+"]))"):this.isClosed&&(i=u([3*o+1,3*o+2,0,1]),h+="\n	"+t+"_crvs.append(rs.AddCurve(["+i+"]))");return h+="\n\n	"+t+"=rs.JoinCurves("+t+"_crvs, True);\n\n",h+="\n	"+t+"_extrudePath1 = rs.AddLine([0,0,0],"+(n?"[0,0,"+-a/2+"]":"[0,"+-a/2+",0]")+")",h+="\n	"+t+"_extrudePath2 = rs.AddLine([0,0,0],"+(n?"[0,0,"+a/2+"]":"[0,"+a/2+",0]")+")",h+="\n	"+t+"_srf1 = rs.ExtrudeCurve("+t+","+t+"_extrudePath1)",h+="\n	"+t+"_srf2 = rs.ExtrudeCurve("+t+","+t+"_extrudePath2)",h+="\n	"+t+"_srf = rs.JoinSurfaces(["+t+"_srf1,"+t+"_srf2], True)",h+="\n\n\n"}},RIPSAW.inheritPrototype(RIPSAW.MasterPiece,RIPSAW.Bezier2D),RIPSAW.Bezier3D=function(t,e){return RIPSAW.MasterPiece.call(this),this.plan=new RIPSAW.Bezier2D(t).normalize(),this.side=[(new RIPSAW.Bezier2D).createDepthProfile(+(e||.2)/2,3),(new RIPSAW.Bezier2D).createDepthProfile(-(e||.2)/2,3)],this.camera=new RIPSAW.Camera,this},RIPSAW.Bezier3D.prototype={set3DView:function(){return this.plan.allow=this.side[0].allow=this.side[1].allow={draw:!1,edit:!1},this.centroid=new RIPSAW.DragNode(.5,.5),this.scale=.8,this},setAllView:function(){return this.centroid=new RIPSAW.DragNode(.75,.4),this.plan.centroid=new RIPSAW.DragNode(.25,.25),this.side[0].centroid=new RIPSAW.DragNode(.25,.75),this.side[1].centroid=new RIPSAW.DragNode(.25,.75),this.scale=1,this.plan.scale=this.side[0].scale=this.side[1].scale=.55,this.allow=this.plan.allow=this.side[0].allow=this.side[1].allow={draw:!0,edit:!0},this.allow.rotate=!1,this},setPlanView:function(){this.allow=this.side[0].allow=this.side[1].allow={draw:!1,edit:!1},this.plan.centroid=new RIPSAW.DragNode(.5,.5),this.plan.scale=1},get3DOutline:function(t){var e,n,i,o,s,r=[this.side[0].getSubdivision(RIPSAW.mesh.n2),this.side[1].getSubdivision(RIPSAW.mesh.n2)],h=[this.plan.getSubdivision(RIPSAW.mesh.n2),this.plan.getSubdivision(RIPSAW.mesh.n2)];for(n=0;2>n;n+=1)for(i=h[n].getPointCount(),e=0;i>e;e+=1)o=h[n].getPoint(e),s=r[n].interpolateX(o.x)[0],"undefined"!=typeof s&&(o.z=s.y/RIPSAW.rDim.depthScale),o.project(this.camera).scale(t||1);return h},place3DIsoCurves:function(t,e){var n,i=t[0].getPointCount();for(e="undefined"!=typeof e?e:5,RIPSAW.pen.configure("design iso"),n=0;i>n;n+=e)RIPSAW.pen.line(this.map(t[0].getPoint(n)),this.map(t[1].getPoint(n)))},place3DOutline:function(t){var e,n=t[0].getPointCount();for(e=0;n-1>e;e+=1)RIPSAW.pen.line(this.map(t[0].getPoint(e)),this.map(t[0].getPoint(e+1))),RIPSAW.pen.line(this.map(t[1].getPoint(e)),this.map(t[1].getPoint(e+1)))},draw3D:function(){var t;this.allow.draw&&(t=this.get3DOutline(),RIPSAW.pen.configure("design outline"),this.place3DOutline(t),RIPSAW.pen.configure("design iso"),this.place3DIsoCurves(t))},draw:function(t){return this.allow.draw&&this.draw3D(),this.plan.draw(),this.side[0].draw(),this.side[1].draw(),this},mouseMove:function(){this.allow.rotate&&this.camera.mouseMove(),this.plan.mouseMove(),this.side[0].mouseMove(),this.side[1].mouseMove()},mouseUp:function(){this.allow.rotate&&this.camera.mouseUp(),this.plan.mouseUp(),this.side[0].mouseUp(),this.side[1].mouseUp()},mouseDown:function(){this.allow.rotate&&this.camera.mouseDown(),this.plan.mouseDown(),this.side[0].mouseDown(),this.side[1].mouseDown()},toSVG:function(){var t,e="",n=this.get3DOutline(100),i=n[0].getPointCount();for(e+="	"+n[0].toSVG()+"\n	"+n[1].toSVG(),e+="\n	<g>",t=0;i>t;t+=5)e+="\n		"+new RIPSAW.Line(n[0].getPoint(t),n[1].getPoint(t)).toSVG();return e+="\n	</g>",RIPSAW.textAssets.SVGHeader+"\n"+e+"\n"+RIPSAW.textAssets.SVGFooter},toRhinoPythonScript:function(){var t=this.plan.toRhinoPythonScript("plan",1,!0)+this.side[0].toRhinoPythonScript("profileTop",2.1,!1)+this.side[1].toRhinoPythonScript("profileBottom",2.2,!1);return RIPSAW.textAssets.rhinoPythonScriptHeader+t+RIPSAW.textAssets.rhinoPythonScriptFooter},stageUpdate:function(){var t=this.stageManager[RIPSAW.stage.no];"undefined"!=typeof t&&(this.updateState(t.threeD),this.plan.updateState(t.plan),this.side[0].updateState(t.side),this.side[1].updateState(t.side))}},RIPSAW.inheritPrototype(RIPSAW.MasterPiece,RIPSAW.Bezier3D),RIPSAW.Pantograph=function(t,e,n,i,o,s){return RIPSAW.MasterPiece.call(this,i,o,s),this.n=t,this.l=e,this.c=n,this.d=this.l*this.c,this.hoverIndex=-1,this.control=[],this.initControl(),this},RIPSAW.Pantograph.prototype={setLegSpan:function(t){return this.d=t,this},initControl:function(){return this.control=[new RIPSAW.DragNode(this.d/2,0,0,1,0,0),new RIPSAW.DragNode(0,-this.getSegmentHeight(0)*this.c,0,0,1,0)],this},updateControl:function(){return this.control[0].temp.x=this.d/2,this.control[1].temp.y=-this.getSegmentHeight(0)*this.c,this},updateGeometry:function(){switch(this.hoverIndex){case 0:this.d=2*this.control[0].temp.x;break;case 1:this.l=Math.pow(Math.pow(this.control[1].temp.y,2)+Math.pow(this.d/2,2),.5)/this.c}return this},getSegmentHeight:function(t){var e=Math.pow((1-this.c)/this.c,t),n=this.l*e,i=this.d*e;return Math.pow(Math.pow(n*this.c,2)-Math.pow(i/2,2),.5)/this.c},getMembers:function(t){var e,n,o,s,r,h=this.l,a=this.d,c=0,u=[];for(i=0;i<this.n;i+=1)e=this.getSegmentHeight(i),n=new RIPSAW.Vector(-a/2,-c).scale(t),s=new RIPSAW.Vector(+a/2*(1-this.c)/this.c,-(c+e)).scale(t),o=new RIPSAW.Vector(+a/2,-c).scale(t),r=new RIPSAW.Vector(-a/2*(1-this.c)/this.c,-(c+e)).scale(t),u.push(new RIPSAW.Line(n,s)),u.push(new RIPSAW.Line(o,r)),a*=(1-this.c)/this.c,h*=(1-this.c)/this.c,c+=e;return u},placeMembers:function(){var t,e=this.getMembers(),n=e.length;for(t=0;n>t;t+=1)RIPSAW.pen.configure("design outline"),RIPSAW.pen.line(this.map(e[t].p1),this.map(e[t].p2));return this},placeControlPoints:function(){var t;for(t=0;t<this.control.length;t+=1)RIPSAW.pen.controlPoint(this.map(this.control[t].temp),this.hoverIndex===t);return this},draw:function(){return RIPSAW.pen.configure("design outline"),this.placeMembers(),RIPSAW.pen.configure("primary control point"),this.placeControlPoints(),this},hasValidLegSpan:function(){return Math.abs(this.d)<this.l},getTotalHeight:function(){var t=0;if(!this.hasValidLegSpan())return t;for(i=0;i<this.n;i+=1)t+=this.getSegmentHeight(i);return t},normalize:function(){var t=1/this.getTotalHeight();return this.l*=t,this.d*=t,this.updateControl(),this},updateHoverState:function(){var t,e=this.control.length;for(this.hoverIndex=-1,t=0;e>t;t+=1)RIPSAW.mouse.hovers(this.map(this.control[t].perm))&&(this.hoverIndex=t)},mouseMove:function(){return RIPSAW.mouse.isDragging?-1!==this.hoverIndex&&(this.control[this.hoverIndex].setDrag(this.getObjectDrag()),this.updateGeometry(),this.updateControl()):this.updateHoverState(),this},mouseUp:function(){return-1!==this.hoverIndex&&this.control[this.hoverIndex].update(),this},mouseDown:function(){return this},toSVG:function(){var t,e=this.getMembers(100),n=e.length,i="";for(t=0;n>t;t+=1)i+="	"+e[t].toSVG()+"\n";return RIPSAW.textAssets.SVGHeader+"\n"+i+RIPSAW.textAssets.SVGFooter}},RIPSAW.inheritPrototype(RIPSAW.MasterPiece,RIPSAW.Pantograph),RIPSAW.CurvingPantograph=function(t,e,n,i,o,s,r){return RIPSAW.MasterPiece.call(this,o,s,r),this.n=t,this.l=e,this.c1=n,this.c2=i,this.d=this.l*this.c1,this.hoverIndex=-1,this.control=[],this.initControl(),this},RIPSAW.CurvingPantograph.prototype={setLegSpan:function(t){return this.d=t,this},initControl:function(){return this.control=[new RIPSAW.DragNode(this.d/2,0,0,1,0,0)],this},updateControl:function(){return this.control[0].temp.x=this.d/2,this},updateGeometry:function(){return this.d=2*this.control[0].temp.x,this},getSegmentHeight:function(t){var e=Math.pow((1-this.c1)/this.c1,t),n=this.l*e,i=this.d*e;return Math.pow(Math.pow(n*this.c1,2)-Math.pow(i/2,2),.5)/this.c1},getMembers:function(t){var e,n,o,s,r,h=[],a=t||1,c=new RIPSAW.Vector(+this.d/2,0),u=new RIPSAW.Vector(-this.d/2,0);for(i=0;i<this.n;i+=1)r=new RIPSAW.Line(c,u),e=this.getSegmentHeight(i),s=r.getMidPerpXY().scale(e*this.c1).p2,o=new RIPSAW.Line(c,s).scale(1/this.c1).p2,n=new RIPSAW.Line(u,s).scale(1/this.c2).p2,h.push(new RIPSAW.Line(c.clone().scale(a),o.clone().scale(a))),h.push(new RIPSAW.Line(u.clone().scale(a),n.clone().scale(a))),c=n,u=o;return h},placeMembers:function(){var t,e=this.getMembers(),n=e.length;for(t=0;n>t;t+=1)RIPSAW.pen.configure("design outline"),RIPSAW.pen.line(this.map(e[t].p1),this.map(e[t].p2));return this},placeControlPoints:function(){var t;for(t=0;t<this.control.length;t+=1)RIPSAW.pen.controlPoint(this.map(this.control[t].temp),this.hoverIndex===t);return this},draw:function(){return RIPSAW.pen.configure("design outline"),this.placeMembers(),RIPSAW.pen.configure("primary control point"),this.placeControlPoints(),this},hasValidLegSpan:function(){return Math.abs(this.d)<this.l},getTotalHeight:function(){var t=0;if(!this.hasValidLegSpan())return t;for(i=0;i<this.n;i+=1)t+=this.getSegmentHeight(i);return t},normalize:function(){var t=1/this.getTotalHeight();return this.l*=t,this.d*=t,this.updateControl(),this},updateHoverState:function(){var t,e=this.control.length;for(this.hoverIndex=-1,t=0;e>t;t+=1)RIPSAW.mouse.hovers(this.map(this.control[t].perm))&&(this.hoverIndex=t)},mouseMove:function(){return RIPSAW.mouse.isDragging?-1!==this.hoverIndex&&(this.control[this.hoverIndex].setDrag(this.getObjectDrag()),this.updateGeometry(),this.updateControl()):this.updateHoverState(),this},mouseUp:function(){return-1!==this.hoverIndex&&this.control[this.hoverIndex].update(),this},mouseDown:function(){return this},toSVG:function(){var t,e=this.getMembers(100),n=e.length,i="";for(t=0;n>t;t+=1)i+="	"+e[t].toSVG()+"\n";return RIPSAW.textAssets.SVGHeader+"\n"+i+RIPSAW.textAssets.SVGFooter}},RIPSAW.inheritPrototype(RIPSAW.MasterPiece,RIPSAW.CurvingPantograph),RIPSAW.VoronoiIntersection=function(t,e){return this.points=t,this.waveFrontIndeces=e,this},RIPSAW.VoronoiIntersection.prototype={toString:function(){var t="";t+="{ "+this.points[0].toString(),this.points[1]&&(t+="; "+this.points[1].toString()),t+=" } - "+this.waveFrontIndeces[0]+", "+this.waveFrontIndeces[1]},matches:function(t){var e=this.waveFrontIndeces,n=t.waveFrontIndeces;return e[0]===n[0]&&e[1]===n[1]},isNearIdenticalTo:function(t){var e,n=this.points.length;if(t.points.length!==n)return!1;for(e=0;n>e;e+=1)if(!this.points[e].isNearEqualTo(t.points[e]))return!1;return this.matches(t)}},RIPSAW.voronoiWave=function(){var t,e,n,i,o,s,r={};return e=.001,n=.8,t=e,o=0,i=1.5,s=!1,r.get=function(){return t},r.set=function(e){return t=e,this},r.step=function(r){var h="undefined"==typeof r?!1:r;return t+=(n-e)*o*RIPSAW.refreshInterval/(1e3*i),e>t&&(o=-1),t>n&&(o=h?1:0,t=e,s=!0),this},r.reset=function(){return t=e,this},r.start=function(){return o=1,this},r.reachedEnd=function(){return s},r.restart=function(){return t=e,o=1,this},r.setMax=function(t){return n=t,this},r.setMin=function(t){return e=t,this},r.setPeriod=function(t){return i=t,this},r},RIPSAW.voronoiWaveFront=function(t){var e=[],n=4,i={},o=t;return i.add=function(t){return e.push(t),this},i.getList=function(){var t,n=e.length,i=[];for(t=0;n>t;t+=1)i.push(e[t].clone());return i},i.clear=function(){return e=[],this},i.build=function(t){var n,i,s,r,h,a,c=o.length;for(e=[],n=0;c>n;n+=1)a=o[n].temp,i=a.clone().add(new RIPSAW.Vector(+t,0)),s=a.clone().add(new RIPSAW.Vector(0,+t)),r=a.clone().add(new RIPSAW.Vector(-t,0)),h=a.clone().add(new RIPSAW.Vector(0,-t)),e.push(new RIPSAW.Line(i,s)),e.push(new RIPSAW.Line(s,r)),e.push(new RIPSAW.Line(r,h)),e.push(new RIPSAW.Line(h,i));return this},i.getIntersections=function(){var t,i,o,s,r,h,a=[],c=e.length;for(t=0;c>t;t+=1)for(o=e[t],i=t+1;c>i;i+=1)Math.floor(t/n)!==Math.floor(i/n)&&(s=e[i],r=o.intersectXY(s,.004),("inside"===r.type||"overlap"===r.type)&&(h=new RIPSAW.VoronoiIntersection(r.points,[t,i]),a.push(h)));return a},i.isControllingIntersection=function(t){var e,n,i,s,r=o.length;for(n=0,i=1e4,e=0;r>e;e+=1)s=o[e].temp,distance=t.getManhattanDistanceTo(s),RIPSAW.areNearEqual(distance,i,.0056)?n+=1:distance<i&&(i=distance,n=1);return n>=2},i.getSimpleIntersections=function(){var t,e,n,i=this.getIntersections(),o=i.length,s=[];for(t=0;o>t;t+=1)e=i[t],n=e.points,(this.isControllingIntersection(n[0])||n[1]&&this.isControllingIntersection(n[1]))&&s.push(e);return s},i},RIPSAW.Voronoi=function(){return RIPSAW.MasterPiece.call(this),this.nodes=[],this.links=[],this.wave=RIPSAW.voronoiWave(),this.waveFront=RIPSAW.voronoiWaveFront(this.control),this},RIPSAW.Voronoi.prototype={addControlPoint:function(t){return this.control.push(new RIPSAW.DragNode(t.x||0,t.y||0)),this},createRectangularGrid:function(t,e,n,i){var o,s;for(o=0;n>o;o+=1)for(s=0;i>s;s+=1)this.addControlPoint(new RIPSAW.Vector(o*t/(n-1),s*e/(i-1),0));return this},createIrregularGrid:function(t){var e;for(e=0;t>e;e+=1)this.addControlPoint({x:Math.random()-.5,y:Math.random()-.5});return this},getBoundingRectangle:function(){var t,e,n=-5e3,i=-5e3,o=5e3,s=5e3,r=this.control.length;for(t=0;r>t;t+=1)e=this.control[t].temp,n=Math.max(n,e.x),o=Math.min(o,e.x),i=Math.max(i,e.y),s=Math.min(s,e.y);return{min:new RIPSAW.Vector(o,s),max:new RIPSAW.Vector(n,i)}},getCentroid:function(){var t=this.getBoundingRectangle();return new RIPSAW.Vector((t.max.x+t.min.x)/2,(t.max.y+t.min.y)/2)},getMaxDim:function(){var t=this.getBoundingRectangle();return Math.max(t.max.x-t.min.x,t.max.y-t.min.y)},moveGeometry:function(t){var e,n,i=this.control.length;for(e=0;i>e;e+=1)n=this.control[e],n.temp.add(t),n.update();return this},scaleGeometry:function(t){var e,n,i=this.control.length,o=t||1;for(e=0;i>e;e+=1)n=this.control[e],n.temp.scale(o),n.update();return this},normalize:function(t){var e,n;return t=t||1,e=this.getCentroid(),n=1/this.getMaxDim()*t,this.moveGeometry(e.scale(-1)).scaleGeometry(n),this},step:function(){var t,e,n,i,o,s,r,h,a=!1;for(this.wave.step(),this.waveFront.build(this.wave.get()),this.nodes=this.waveFront.getSimpleIntersections(),t=0,e=this.nodes.length;e>t;t+=1){for(o=this.nodes[t],r=o.waveFrontIndeces,a=!1,n=0,i=this.links.length;i>n;n+=1)s=this.links[n],h=s.waveFrontIndeces,r[0]===h[0]&&r[1]===h[1]&&(s.isOverlapLink||(s.p2=o.points[0]),a=!0);a||(1===o.points.length?this.links.push({p1:o.points[0],isOverlapLink:!1,waveFrontIndeces:o.waveFrontIndeces}):2===o.points.length&&this.links.push({p1:o.points[0],p2:o.points[1],isOverlapLink:!0,waveFrontIndeces:o.waveFrontIndeces}))}return this},placeWaveFront:function(){var t,e,n=this.waveFront.getList(),i=n.length;for(t=0;i>t;t+=1)e=n[t],RIPSAW.pen.line(this.map(e.p1),this.map(e.p2));return this},placeLinks:function(){var t,e,n=this.links.length;for(e=0;n>e;e+=1)t=this.links[e],t.p2&&(RIPSAW.pen.line(this.map(t.p1),this.map(t.p2)),RIPSAW.pen.controlPoint(this.map(t.p1)),RIPSAW.pen.controlPoint(this.map(t.p2)));return this},placeNodes:function(){var t,e=this.nodes.length;for(t=0,e=this.nodes.length;e>t;t+=1)RIPSAW.pen.controlPoint(this.map(this.nodes[t].points[0]));return this},draw:function(t){var e,n;for(this.step(),RIPSAW.pen.configure("primary control point"),e=0,n=this.control.length;n>e;e+=1)RIPSAW.pen.controlPoint(this.map(this.control[e].temp),this.hoverIndex===e);return RIPSAW.pen.configure("design thin"),this.placeWaveFront(),RIPSAW.pen.configure("design iso"),this.placeLinks(),RIPSAW.pen.configure("point"),this.placeNodes(),this},mouseUp:function(){return-1!==this.hoverIndex&&this.control[this.hoverIndex].update(),this},mouseDown:function(){return this},updateHoverState:function(){var t,e=this.control.length;for(this.hoverIndex=-1,t=0;e>t;t+=1)RIPSAW.mouse.hovers(this.map(this.control[t].perm))&&(this.hoverIndex=t);return this},mouseMove:function(){RIPSAW.mouse.getNormalizedDrag();return RIPSAW.mouse.isDragging?-1!==this.hoverIndex&&this.control[this.hoverIndex].setDrag(this.getObjectDrag()):this.updateHoverState(),this},mouseDownRight:function(){return console.log(this.toRhinoPythonScript()),this.links=[],this.wave.reset().start(),this},toSVGPath:function(t){var e,n,i="",o=this.links.length,s=t||100;for(n=0;o>n;n+=1)e=this.links[n],e.p2&&(i+=new RIPSAW.Line(e.p1.clone().scale(s),e.p2.clone().scale(s)).toSVG()+"\n");return i},toSVG:function(){return RIPSAW.textAssets.SVGHeader+this.toSVGPath()+RIPSAW.textAssets.SVGFooter},toRhinoPythonScript:function(t){var e,n,i,o="",s=t||100;for(o=RIPSAW.textAssets.rhinoPythonScriptHeader,n=0,i=this.control.length;i>n;n+=1)o+="	rs.AddPoint("+this.control[n].temp.clone().scale(s).toRhinoPythonScript()+")\n";for(n=0,i=this.links.length;i>n;n+=1)e=this.links[n],e.p2&&(o+="	"+new RIPSAW.Line(e.p1.clone().scale(s),e.p2.clone().scale(s)).toRhinoPythonScript()+"\n");return o+=RIPSAW.textAssets.rhinoPythonScriptFooter}},RIPSAW.inheritPrototype(RIPSAW.MasterPiece,RIPSAW.Voronoi);